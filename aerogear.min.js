/*! AeroGear JavaScript Library - v2.0.0-beta1 - 2014-10-09
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){function r(e,t,r){if(4!==t.length)throw new h.exception.invalid("invalid aes block size");var n=e.c[r],i=t[0]^n[0],a=t[r?3:1]^n[1],s=t[2]^n[2];t=t[r?1:3]^n[3];var o,c,u,f,l=n.length/4-2,p=4,d=[0,0,0,0];o=e.n[r],e=o[0];var g=o[1],m=o[2],b=o[3],y=o[4];for(f=0;l>f;f++)o=e[i>>>24]^g[255&a>>16]^m[255&s>>8]^b[255&t]^n[p],c=e[a>>>24]^g[255&s>>16]^m[255&t>>8]^b[255&i]^n[p+1],u=e[s>>>24]^g[255&t>>16]^m[255&i>>8]^b[255&a]^n[p+2],t=e[t>>>24]^g[255&i>>16]^m[255&a>>8]^b[255&s]^n[p+3],p+=4,i=o,a=c,s=u;for(f=0;4>f;f++)d[r?3&-f:f]=y[i>>>24]<<24^y[255&a>>16]<<16^y[255&s>>8]<<8^y[255&t]^n[p++],o=i,i=a,a=s,s=t,t=o;return d}function n(e,t){var r,n,i,a=t.slice(0),s=e.u,o=e.c,c=s[0],u=s[1],h=s[2],f=s[3],l=s[4],p=s[5],d=s[6],g=s[7];for(r=0;64>r;r++)16>r?n=a[r]:(n=a[15&r+1],i=a[15&r+14],n=a[15&r]=0|(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+a[15&r]+a[15&r+9]),n=n+g+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(d^l&(p^d))+o[r],g=d,d=p,p=l,l=0|f+n,f=h,h=u,u=c,c=0|n+(u&h^f&(u^h))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10);s[0]=0|s[0]+c,s[1]=0|s[1]+u,s[2]=0|s[2]+h,s[3]=0|s[3]+f,s[4]=0|s[4]+l,s[5]=0|s[5]+p,s[6]=0|s[6]+d,s[7]=0|s[7]+g}function i(e,t){var r,n=h.random.F[e],i=[];for(r in n)n.hasOwnProperty(r)&&i.push(n[r]);for(r=0;i.length>r;r++)i[r](t)}function a(e){e.c=s(e).concat(s(e)),e.H=new h.cipher.aes(e.c)}function s(e){for(var t=0;4>t&&(e.h[t]=0|e.h[t]+1,!e.h[t]);t++);return e.H.encrypt(e.h)}this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,r,n=this[this.collectionName]||{};if(this[this.collectionName]=n,!e)return this;if("string"==typeof e)n[e]=AeroGear[this.lib].adapters[this.type](e,this.config);else if(Array.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?n[r]=AeroGear[this.lib].adapters[this.type](r,this.config):r.name&&(r.settings=AeroGear.extend(r.settings||{},this.config),n[r.name]=AeroGear[this.lib].adapters[r.type||this.type](r.name,r.settings));else{if(!e.name)return this;e.settings=AeroGear.extend(e.settings||{},this.config),n[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings)}return this[this.collectionName]=n,this},this.remove=function(e){var t,r,n=this[this.collectionName]||{};if("string"==typeof e)delete n[e];else if(Array.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?delete n[r]:delete n[r.name];else e&&delete n[e.name];return this[this.collectionName]=n,this}},AeroGear.extend=function(){var e,t,r,n=arguments[0];for(t=1;arguments.length>t;t++){r=arguments[t];for(e in r)n[e]=r[e]}return n},function(){function e(e,t,r){var n=t&&r||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(t[n+i++]=g[e])});16>i;)t[n+i++]=0;return t}function t(e,t){var r=t||0,n=d;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]}function r(e,r,n){var i=r&&n||0,a=r||[];e=e||{};var s=null!=e.clockseq?e.clockseq:v,o=null!=e.msecs?e.msecs:(new Date).getTime(),c=null!=e.nsecs?e.nsecs:w+1,u=o-A+(c-w)/1e4;if(0>u&&null==e.clockseq&&(s=16383&s+1),(0>u||o>A)&&null==e.nsecs&&(c=0),c>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");A=o,w=c,v=s,o+=122192928e5;var h=(1e4*(268435455&o)+c)%4294967296;a[i++]=255&h>>>24,a[i++]=255&h>>>16,a[i++]=255&h>>>8,a[i++]=255&h;var f=268435455&1e4*(o/4294967296);a[i++]=255&f>>>8,a[i++]=255&f,a[i++]=16|15&f>>>24,a[i++]=255&f>>>16,a[i++]=128|s>>>8,a[i++]=255&s;for(var l=e.node||y,p=0;6>p;p++)a[i+p]=l[p];return r?r:t(a)}function n(e,r,n){var i=r&&n||0;"string"==typeof e&&(r="binary"==e?new p(16):null,e=null),e=e||{};var a=e.random||(e.rng||l)();if(a[6]=64|15&a[6],a[8]=128|63&a[8],r)for(var s=0;16>s;s++)r[i+s]=a[s];return r||t(a)}var i,a,s,o=this,c=Array(16);if(i=function(){for(var e,e,t=c,r=0,r=0;16>r;r++)0==(3&r)&&(e=4294967296*Math.random()),t[r]=255&e>>>((3&r)<<3);return t},o.crypto&&crypto.getRandomValues){var u=new Uint32Array(4);s=function(){crypto.getRandomValues(u);for(var e=0;16>e;e++)c[e]=255&u[e>>2]>>>8*(3&e);return c}}try{var h=require("crypto").randomBytes;a=h&&function(){return h(16)}}catch(f){}for(var l=a||s||i,p="function"==typeof Buffer?Buffer:Array,d=[],g={},m=0;256>m;m++)d[m]=(m+256).toString(16).substr(1),g[d[m]]=m;var b=l(),y=[1|b[0],b[1],b[2],b[3],b[4],b[5]],v=16383&(b[6]<<8|b[7]),A=0,w=0,S=n;if(S.v1=r,S.v4=n,S.parse=e,S.unparse=t,S.BufferClass=p,S.mathRNG=i,S.nodeRNG=a,S.whatwgRNG=s,"undefined"!=typeof module)module.exports=S;else{var D=o.uuid;S.noConflict=function(){return o.uuid=D,S},o.uuid=S}}(),function(){var r=e!==t?e:exports,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=function(){try{document.createElement("$")}catch(e){return e}}();r.btoa||(r.btoa=function(e){for(var t,r,a=0,s=n,o="";e.charAt(0|a)||(s="=",a%1);o+=s.charAt(63&t>>8-8*(a%1))){if(r=e.charCodeAt(a+=.75),r>255)throw i;t=t<<8|r}return o}),r.atob||(r.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4)throw i;for(var t,r,a=0,s=0,o="";r=e.charAt(s++);~r&&(t=a%4?64*t+r:r,a++%4)?o+=String.fromCharCode(255&t>>(6&-2*a)):0)r=n.indexOf(r);return o})}();var o=void 0,c=!0,u=!1,h={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=h),h.cipher.aes=function(e){this.n[0][0][0]||this.K();var t,r,n,i,a=this.n[0][4],s=this.n[1];t=e.length;var o=1;if(4!==t&&6!==t&&8!==t)throw new h.exception.invalid("invalid aes key size");for(this.c=[n=e.slice(0),i=[]],e=t;4*t+28>e;e++)r=n[e-1],(0===e%t||8===t&&4===e%t)&&(r=a[r>>>24]<<24^a[255&r>>16]<<16^a[255&r>>8]<<8^a[255&r],0===e%t&&(r=r<<8^r>>>24^o<<24,o=o<<1^283*(o>>7))),n[e]=n[e-t]^r;for(t=0;e;t++,e--)r=n[3&t?e:e-4],i[t]=4>=e||4>t?r:s[0][a[r>>>24]]^s[1][a[255&r>>16]]^s[2][a[255&r>>8]]^s[3][a[255&r]]},h.cipher.aes.prototype={encrypt:function(e){return r(this,e,0)},decrypt:function(e){return r(this,e,1)},n:[[[],[],[],[],[]],[[],[],[],[],[]]],K:function(){var e,t,r,n,i,a,s,o=this.n[0],c=this.n[1],u=o[4],h=c[4],f=[],l=[];for(e=0;256>e;e++)l[(f[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!u[t];t^=n||1,r=l[r]||1)for(a=r^r<<1^r<<2^r<<3^r<<4,a=99^(a>>8^255&a),u[t]=a,h[a]=t,i=f[e=f[n=f[t]]],s=16843009*i^65537*e^257*n^16843008*t,i=257*f[a]^16843008*a,e=0;4>e;e++)o[e][t]=i=i<<24^i>>>8,c[e][a]=s=s<<24^s>>>8;for(e=0;5>e;e++)o[e]=o[e].slice(0),c[e]=c[e].slice(0)}},h.bitArray={bitSlice:function(e,t,r){return e=h.bitArray.U(e.slice(t/32),32-(31&t)).slice(1),r===o?e:h.bitArray.clamp(e,r-t)},extract:function(e,t,r){var n=Math.floor(31&-t-r);return(-32&(t+r-1^t)?e[0|t/32]<<32-n^e[0|t/32+1]>>>n:e[0|t/32]>>>n)&(1<<r)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var r=e[e.length-1],n=h.bitArray.getPartial(r);return 32===n?e.concat(t):h.bitArray.U(t,n,0|r,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+h.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(t>32*e.length)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t&=31,r>0&&t&&(e[r-1]=h.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return 32===e?t:(r?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(h.bitArray.bitLength(e)!==h.bitArray.bitLength(t))return u;var r,n=0;for(r=0;e.length>r;r++)n|=e[r]^t[r];return 0===n},U:function(e,t,r,n){var i;for(i=0,n===o&&(n=[]);t>=32;t-=32)n.push(r),r=0;if(0===t)return n.concat(e);for(i=0;e.length>i;i++)n.push(r|e[i]>>>t),r=e[i]<<32-t;return i=e.length?e[e.length-1]:0,e=h.bitArray.getPartial(i),n.push(h.bitArray.partial(31&t+e,t+e>32?r:n.pop(),1)),n},ba:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},h.codec.utf8String={fromBits:function(e){var t,r,n="",i=h.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(r=e[t/4]),n+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(n))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,r=[],n=0;for(t=0;e.length>t;t++)n=n<<8|e.charCodeAt(t),3===(3&t)&&(r.push(n),n=0);return 3&t&&r.push(h.bitArray.partial(8*(3&t),n)),r}},h.codec.hex={fromBits:function(e){var t,r="";for(t=0;e.length>t;t++)r+=((0|e[t])+0xf00000000000).toString(16).substr(4);return r.substr(0,h.bitArray.bitLength(e)/4)},toBits:function(e){var t,r,n=[];for(e=e.replace(/\s|0x/g,""),r=e.length,e+="00000000",t=0;e.length>t;t+=8)n.push(0^parseInt(e.substr(t,8),16));return h.bitArray.clamp(n,4*r)}},h.hash.sha256=function(e){this.c[0]||this.K(),e?(this.u=e.u.slice(0),this.p=e.p.slice(0),this.k=e.k):this.reset()},h.hash.sha256.hash=function(e){return(new h.hash.sha256).update(e).finalize()},h.hash.sha256.prototype={blockSize:512,reset:function(){return this.u=this.R.slice(0),this.p=[],this.k=0,this},update:function(e){"string"==typeof e&&(e=h.codec.utf8String.toBits(e));var t,r=this.p=h.bitArray.concat(this.p,e);for(t=this.k,e=this.k=t+h.bitArray.bitLength(e),t=-512&512+t;e>=t;t+=512)n(this,r.splice(0,16));return this},finalize:function(){var e,t=this.p,r=this.u,t=h.bitArray.concat(t,[h.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.k/4294967296)),t.push(0|this.k);t.length;)n(this,t.splice(0,16));return this.reset(),r},R:[],c:[],K:function(){function e(e){return 0|4294967296*(e-Math.floor(e))}var t,r=0,n=2;e:for(;64>r;n++){for(t=2;n>=t*t;t++)if(0===n%t)continue e;8>r&&(this.R[r]=e(Math.pow(n,.5))),this.c[r]=e(Math.pow(n,1/3)),r++}}},h.mode.gcm={name:"gcm",encrypt:function(e,t,r,n,i){var a=t.slice(0);return t=h.bitArray,n=n||[],e=h.mode.gcm.O(c,e,a,n,r,i||128),t.concat(e.data,e.tag)},decrypt:function(e,t,r,n,i){var a=t.slice(0),s=h.bitArray,o=s.bitLength(a);if(i=i||128,n=n||[],o>=i?(t=s.bitSlice(a,o-i),a=s.bitSlice(a,0,o-i)):(t=a,a=[]),e=h.mode.gcm.O(u,e,a,n,r,i),!s.equal(e.tag,t))throw new h.exception.corrupt("gcm: tag doesn't match");return e.data},aa:function(e,t){var r,n,i,a,s,o=h.bitArray.ba;for(i=[0,0,0,0],a=t.slice(0),r=0;128>r;r++){for((n=0!==(e[Math.floor(r/32)]&1<<31-r%32))&&(i=o(i,a)),s=0!==(1&a[3]),n=3;n>0;n--)a[n]=a[n]>>>1|(1&a[n-1])<<31;a[0]>>>=1,s&&(a[0]^=-520093696)}return i},j:function(e,t,r){var n,i=r.length;for(t=t.slice(0),n=0;i>n;n+=4)t[0]^=4294967295&r[n],t[1]^=4294967295&r[n+1],t[2]^=4294967295&r[n+2],t[3]^=4294967295&r[n+3],t=h.mode.gcm.aa(t,e);return t},O:function(e,t,r,n,i,a){var s,o,c,u,f,l,p,d,g=h.bitArray;for(l=r.length,p=g.bitLength(r),d=g.bitLength(n),o=g.bitLength(i),s=t.encrypt([0,0,0,0]),96===o?(i=i.slice(0),i=g.concat(i,[1])):(i=h.mode.gcm.j(s,[0,0,0,0],i),i=h.mode.gcm.j(s,i,[0,0,Math.floor(o/4294967296),4294967295&o])),o=h.mode.gcm.j(s,[0,0,0,0],n),f=i.slice(0),n=o.slice(0),e||(n=h.mode.gcm.j(s,o,r)),u=0;l>u;u+=4)f[3]++,c=t.encrypt(f),r[u]^=c[0],r[u+1]^=c[1],r[u+2]^=c[2],r[u+3]^=c[3];return r=g.clamp(r,p),e&&(n=h.mode.gcm.j(s,o,r)),e=[Math.floor(d/4294967296),4294967295&d,Math.floor(p/4294967296),4294967295&p],n=h.mode.gcm.j(s,n,e),c=t.encrypt(i),n[0]^=c[0],n[1]^=c[1],n[2]^=c[2],n[3]^=c[3],{tag:g.bitSlice(n,0,a),data:r}}},h.misc.hmac=function(e,t){this.Q=t=t||h.hash.sha256;var r,n=[[],[]],i=t.prototype.blockSize/32;for(this.q=[new t,new t],e.length>i&&(e=t.hash(e)),r=0;i>r;r++)n[0][r]=909522486^e[r],n[1][r]=1549556828^e[r];this.q[0].update(n[0]),this.q[1].update(n[1])},h.misc.hmac.prototype.encrypt=h.misc.hmac.prototype.mac=function(e){return e=new this.Q(this.q[0]).update(e).finalize(),new this.Q(this.q[1]).update(e).finalize()},h.misc.pbkdf2=function(e,t,r,n,i){if(r=r||1e3,0>n||0>r)throw h.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=h.codec.utf8String.toBits(e)),"string"==typeof t&&(t=h.codec.utf8String.toBits(t)),i=i||h.misc.hmac,e=new i(e);var a,s,o,c,u=[],f=h.bitArray;for(c=1;(n||1)>32*u.length;c++){for(i=a=e.encrypt(f.concat(t,[c])),s=1;r>s;s++)for(a=e.encrypt(a),o=0;a.length>o;o++)i[o]^=a[o];u=u.concat(i)}return n&&(u=f.clamp(u,n)),u},h.prng=function(e){this.e=[new h.hash.sha256],this.l=[0],this.L=0,this.B={},this.J=0,this.N={},this.T=this.g=this.m=this.$=0,this.c=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.H=o,this.I=e,this.s=u,this.F={progress:{},seeded:{}},this.o=this.Z=0,this.C=1,this.D=2,this.X=65536,this.M=[0,48,64,96,128,192,256,384,512,768,1024],this.Y=3e4,this.W=80},h.prng.prototype={randomWords:function(e,t){var r,n=[];r=this.isReady(t);var i;if(r===this.o)throw new h.exception.notReady("generator isn't seeded");if(r&this.D){r=!(r&this.C),i=[];var o,c=0;for(this.T=i[0]=(new Date).valueOf()+this.Y,o=0;16>o;o++)i.push(0|4294967296*Math.random());for(o=0;this.e.length>o&&(i=i.concat(this.e[o].finalize()),c+=this.l[o],this.l[o]=0,!(!r&&this.L&1<<o));o++);for(this.L>=1<<this.e.length&&(this.e.push(new h.hash.sha256),this.l.push(0)),this.g-=c,c>this.m&&(this.m=c),this.L++,this.c=h.hash.sha256.hash(this.c.concat(i)),this.H=new h.cipher.aes(this.c),r=0;4>r&&(this.h[r]=0|this.h[r]+1,!this.h[r]);r++);}for(r=0;e>r;r+=4)0===(r+1)%this.X&&a(this),i=s(this),n.push(i[0],i[1],i[2],i[3]);return a(this),n.slice(0,e)},setDefaultParanoia:function(e){this.I=e},addEntropy:function(e,t,r){r=r||"user";var n,a,s=(new Date).valueOf(),c=this.B[r],u=this.isReady(),f=0;switch(n=this.N[r],n===o&&(n=this.N[r]=this.$++),c===o&&(c=this.B[r]=0),this.B[r]=(this.B[r]+1)%this.e.length,typeof e){case"number":t===o&&(t=1),this.e[c].update([n,this.J++,1,t,s,1,0|e]);break;case"object":if(r=Object.prototype.toString.call(e),"[object Uint32Array]"===r){for(a=[],r=0;e.length>r;r++)a.push(e[r]);e=a}else for("[object Array]"!==r&&(f=1),r=0;e.length>r&&!f;r++)"number"!=typeof e[r]&&(f=1);if(!f){if(t===o)for(r=t=0;e.length>r;r++)for(a=e[r];a>0;)t++,a>>>=1;this.e[c].update([n,this.J++,2,t,s,e.length].concat(e))}break;case"string":t===o&&(t=e.length),this.e[c].update([n,this.J++,3,t,s,e.length]),this.e[c].update(e);break;default:f=1}if(f)throw new h.exception.bug("random: addEntropy only supports number, array of numbers or string");this.l[c]+=t,this.g+=t,u===this.o&&(this.isReady()!==this.o&&i("seeded",Math.max(this.m,this.g)),i("progress",this.getProgress()))},isReady:function(e){return e=this.M[e!==o?e:this.I],this.m&&this.m>=e?this.l[0]>this.W&&(new Date).valueOf()>this.T?this.D|this.C:this.C:this.g>=e?this.D|this.o:this.o},getProgress:function(e){return e=this.M[e?e:this.I],this.m>=e?1:this.g>e?1:this.g/e},startCollectors:function(){if(!this.s){if(e.addEventListener)e.addEventListener("load",this.v,u),e.addEventListener("mousemove",this.w,u);else{if(!document.attachEvent)throw new h.exception.bug("can't attach event");document.attachEvent("onload",this.v),document.attachEvent("onmousemove",this.w)}this.s=c}},stopCollectors:function(){this.s&&(e.removeEventListener?(e.removeEventListener("load",this.v,u),e.removeEventListener("mousemove",this.w,u)):e.detachEvent&&(e.detachEvent("onload",this.v),e.detachEvent("onmousemove",this.w)),this.s=u)},addEventListener:function(e,t){this.F[e][this.Z++]=t},removeEventListener:function(e,t){var r,n,i=this.F[e],a=[];for(n in i)i.hasOwnProperty(n)&&i[n]===t&&a.push(n);for(r=0;a.length>r;r++)n=a[r],delete i[n]},w:function(e){h.random.addEntropy([e.x||e.clientX||e.offsetX||0,e.y||e.clientY||e.offsetY||0],2,"mouse")},v:function(){h.random.addEntropy((new Date).valueOf(),2,"loadtime")}},h.random=new h.prng(6);try{if("undefined"!=typeof module&&module.exports){var f=require("crypto").randomBytes(128);h.random.addEntropy(f,1024,"crypto['randomBytes']")}else if(e&&e.crypto&&e.crypto.getRandomValues){var l=new Uint32Array(32);e.crypto.getRandomValues(l),h.random.addEntropy(l,1024,"crypto['getRandomValues']")}}catch(p){}h.bn=function(e){this.initWith(e)},h.bn.prototype={radix:24,maxMul:8,d:h.bn,copy:function(){return new this.d(this)},initWith:function(e){var t,r=0;switch(typeof e){case"object":this.limbs=e.limbs.slice(0);break;case"number":this.limbs=[e],this.normalize();break;case"string":for(e=e.replace(/^0x/,""),this.limbs=[],t=this.radix/4,r=0;e.length>r;r+=t)this.limbs.push(parseInt(e.substring(Math.max(e.length-r-t,0),e.length-r),16));break;default:this.limbs=[0]}return this},equals:function(e){"number"==typeof e&&(e=new this.d(e));var t,r=0;for(this.fullReduce(),e.fullReduce(),t=0;this.limbs.length>t||e.limbs.length>t;t++)r|=this.getLimb(t)^e.getLimb(t);return 0===r},getLimb:function(e){return e>=this.limbs.length?0:this.limbs[e]},greaterEquals:function(e){"number"==typeof e&&(e=new this.d(e));var t,r,n,i=0,a=0;for(t=Math.max(this.limbs.length,e.limbs.length)-1;t>=0;t--)r=this.getLimb(t),n=e.getLimb(t),a|=n-r&~i,i|=r-n&~a;return(a|~i)>>>31},toString:function(){this.fullReduce();var e,t,r="",n=this.limbs;for(e=0;this.limbs.length>e;e++){for(t=n[e].toString(16);this.limbs.length-1>e&&6>t.length;)t="0"+t;r=t+r}return"0x"+r},addM:function(e){"object"!=typeof e&&(e=new this.d(e));var t=this.limbs,r=e.limbs;for(e=t.length;r.length>e;e++)t[e]=0;for(e=0;r.length>e;e++)t[e]+=r[e];return this},doubleM:function(){var e,t,r=0,n=this.radix,i=this.radixMask,a=this.limbs;for(e=0;a.length>e;e++)t=a[e],t=t+t+r,a[e]=t&i,r=t>>n;return r&&a.push(r),this},halveM:function(){var e,t,r=0,n=this.radix,i=this.limbs;for(e=i.length-1;e>=0;e--)t=i[e],i[e]=t+r>>1,r=(1&t)<<n;return i[i.length-1]||i.pop(),this},subM:function(e){"object"!=typeof e&&(e=new this.d(e));var t=this.limbs,r=e.limbs;for(e=t.length;r.length>e;e++)t[e]=0;for(e=0;r.length>e;e++)t[e]-=r[e];return this},mod:function(e){var t=!this.greaterEquals(new h.bn(0));e=new h.bn(e).normalize();var r=new h.bn(this).normalize(),n=0;for(t&&(r=new h.bn(0).subM(r).normalize());r.greaterEquals(e);n++)e.doubleM();for(t&&(r=e.sub(r).normalize());n>0;n--)e.halveM(),r.greaterEquals(e)&&r.subM(e).normalize();return r.trim()},inverseMod:function(e){var t,r=new h.bn(1),n=new h.bn(0),i=new h.bn(this),a=new h.bn(e),s=1;if(!(1&e.limbs[0]))throw new h.exception.invalid("inverseMod: p must be odd");do for(1&i.limbs[0]&&(i.greaterEquals(a)||(t=i,i=a,a=t,t=r,r=n,n=t),i.subM(a),i.normalize(),r.greaterEquals(n)||r.addM(e),r.subM(n)),i.halveM(),1&r.limbs[0]&&r.addM(e),r.normalize(),r.halveM(),t=s=0;i.limbs.length>t;t++)s|=i.limbs[t];while(s);if(!a.equals(1))throw new h.exception.invalid("inverseMod: p and x must be relatively prime");return n},add:function(e){return this.copy().addM(e)},sub:function(e){return this.copy().subM(e)},mul:function(e){"number"==typeof e&&(e=new this.d(e));var t,r,n=this.limbs,i=e.limbs,a=n.length,s=i.length,o=new this.d,c=o.limbs,u=this.maxMul;for(t=0;this.limbs.length+e.limbs.length+1>t;t++)c[t]=0;for(t=0;a>t;t++){for(r=n[t],e=0;s>e;e++)c[t+e]+=r*i[e];--u||(u=this.maxMul,o.cnormalize())}return o.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(e){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs);var t,r,n=new this.d(1),i=this;for(t=0;e.length>t;t++)for(r=0;this.radix>r;r++)e[t]&1<<r&&(n=n.mul(i)),i=i.square();return n},mulmod:function(e,t){return this.mod(t).mul(e.mod(t)).mod(t)},powermod:function(e,t){for(var r=new h.bn(1),n=new h.bn(this),i=new h.bn(e);1&i.limbs[0]&&(r=r.mulmod(n,t)),i.halveM(),!i.equals(0);)n=n.mulmod(n,t);return r.normalize().reduce()},trim:function(){var e,t=this.limbs;do e=t.pop();while(t.length&&0===e);return t.push(e),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var e,t,r=0,n=this.ipv,i=this.limbs,a=i.length,s=this.radixMask;for(e=0;a>e||0!==r&&-1!==r;e++)r=(i[e]||0)+r,t=i[e]=r&s,r=(r-t)*n;return-1===r&&(i[e-1]-=this.placeVal),this},cnormalize:function(){var e,t,r=0,n=this.ipv,i=this.limbs,a=i.length,s=this.radixMask;for(e=0;a-1>e;e++)r=i[e]+r,t=i[e]=r&s,r=(r-t)*n;return i[e]+=r,this},toBits:function(e){this.fullReduce(),e=e||this.exponent||this.bitLength();var t=Math.floor((e-1)/24),r=h.bitArray,n=[r.partial((-8&e+7)%this.radix||this.radix,this.getLimb(t))];for(t--;t>=0;t--)n=r.concat(n,[r.partial(Math.min(this.radix,e),this.getLimb(t))]),e-=this.radix;return n},bitLength:function(){this.fullReduce();for(var e=this.radix*(this.limbs.length-1),t=this.limbs[this.limbs.length-1];t;t>>>=1)e++;return-8&e+7}},h.bn.fromBits=function(e){var t=new this,r=[],n=h.bitArray,i=this.prototype,a=Math.min(this.bitLength||4294967296,n.bitLength(e)),s=a%i.radix||i.radix;for(r[0]=n.extract(e,0,s);a>s;s+=i.radix)r.unshift(n.extract(e,s,i.radix));return t.limbs=r,t},h.bn.prototype.ipv=1/(h.bn.prototype.placeVal=Math.pow(2,h.bn.prototype.radix)),h.bn.prototype.radixMask=(1<<h.bn.prototype.radix)-1,h.bn.pseudoMersennePrime=function(e,t){function r(e){this.initWith(e)}var n,i,a=r.prototype=new h.bn;for(n=a.modOffset=Math.ceil(i=e/a.radix),a.exponent=e,a.offset=[],a.factor=[],a.minOffset=n,a.fullMask=0,a.fullOffset=[],a.fullFactor=[],a.modulus=r.modulus=new h.bn(Math.pow(2,e)),a.fullMask=0|-Math.pow(2,e%a.radix),n=0;t.length>n;n++)a.offset[n]=Math.floor(t[n][0]/a.radix-i),a.fullOffset[n]=Math.ceil(t[n][0]/a.radix-i),a.factor[n]=t[n][1]*Math.pow(.5,e-t[n][0]+a.offset[n]*a.radix),a.fullFactor[n]=t[n][1]*Math.pow(.5,e-t[n][0]+a.fullOffset[n]*a.radix),a.modulus.addM(new h.bn(Math.pow(2,t[n][0])*t[n][1])),a.minOffset=Math.min(a.minOffset,-a.offset[n]);return a.d=r,a.modulus.cnormalize(),a.reduce=function(){var e,t,r,n,i=this.modOffset,a=this.limbs,s=this.offset,o=this.offset.length,c=this.factor;for(e=this.minOffset;a.length>i;){for(r=a.pop(),n=a.length,t=0;o>t;t++)a[n+s[t]]-=c[t]*r;e--,e||(a.push(0),this.cnormalize(),e=this.minOffset)}return this.cnormalize(),this},a.V=-1===a.fullMask?a.reduce:function(){var e,t,r=this.limbs,n=r.length-1;if(this.reduce(),n===this.modOffset-1){for(t=r[n]&this.fullMask,r[n]-=t,e=0;this.fullOffset.length>e;e++)r[n+this.fullOffset[e]]-=this.fullFactor[e]*t;this.normalize()}},a.fullReduce=function(){var e,t;for(this.V(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this.V(),t=this.limbs.length;this.modOffset>t;t++)this.limbs[t]=0;for(e=this.greaterEquals(this.modulus),t=0;this.limbs.length>t;t++)this.limbs[t]-=this.modulus.limbs[t]*e;return this.cnormalize(),this},a.inverse=function(){return this.power(this.modulus.sub(2))},r.fromBits=h.bn.fromBits,r};var d=h.bn.pseudoMersennePrime;h.bn.prime={p127:d(127,[[0,-1]]),p25519:d(255,[[0,-19]]),p192k:d(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:d(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:d(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:d(192,[[0,-1],[64,-1]]),p224:d(224,[[0,1],[96,-1]]),p256:d(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:d(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:d(521,[[0,-1]])},h.bn.random=function(e,t){"object"!=typeof e&&(e=new h.bn(e));for(var r,n,i=e.limbs.length,a=e.limbs[i-1]+1,s=new h.bn;;){do r=h.random.randomWords(i,t),0>r[i-1]&&(r[i-1]+=4294967296);while(Math.floor(r[i-1]/a)===Math.floor(4294967296/a));for(r[i-1]%=a,n=0;i-1>n;n++)r[n]&=e.radixMask;if(s.limbs=r,!s.greaterEquals(e))return s}},h.ecc={},h.ecc.point=function(e,t,r){t===o?this.isIdentity=c:(this.x=t,this.y=r,this.isIdentity=u),this.curve=e},h.ecc.point.prototype={toJac:function(){return new h.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(e){return this.toJac().mult(e,this).toAffine()},mult2:function(e,t,r){return this.toJac().mult2(e,this,t,r).toAffine()},multiples:function(){var e,t,r;if(this.S===o)for(r=this.toJac().doubl(),e=this.S=[new h.ecc.point(this.curve),this,r.toAffine()],t=3;16>t;t++)r=r.add(this),e.push(r.toAffine());return this.S},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return h.bitArray.concat(this.x.toBits(),this.y.toBits())}},h.ecc.pointJac=function(e,t,r,n){t===o?this.isIdentity=c:(this.x=t,this.y=r,this.z=n,this.isIdentity=u),this.curve=e},h.ecc.pointJac.prototype={add:function(e){var t,r,n,i;if(this.curve!==e.curve)throw"sjcl['ecc']['add'](): Points must be on the same curve to add them!";return this.isIdentity?e.toJac():e.isIdentity?this:(t=this.z.square(),r=e.x.mul(t).subM(this.x),r.equals(0)?this.y.equals(e.y.mul(t.mul(this.z)))?this.doubl():new h.ecc.pointJac(this.curve):(t=e.y.mul(t.mul(this.z)).subM(this.y),n=r.square(),e=t.square(),i=r.square().mul(r).addM(this.x.add(this.x).mul(n)),e=e.subM(i),t=this.x.mul(n).subM(e).mul(t),n=this.y.mul(r.square().mul(r)),t=t.subM(n),r=this.z.mul(r),new h.ecc.pointJac(this.curve,e,t,r)))},doubl:function(){if(this.isIdentity)return this;var e=this.y.square(),t=e.mul(this.x.mul(4)),r=e.square().mul(8),e=this.z.square(),n=""+this.curve.a==""+new h.bn(-3)?this.x.sub(e).mul(3).mul(this.x.add(e)):this.x.square().mul(3).add(e.square().mul(this.curve.a)),e=n.square().subM(t).subM(t),t=t.sub(e).mul(n).subM(r),r=this.y.add(this.y).mul(this.z);return new h.ecc.pointJac(this.curve,e,t,r)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new h.ecc.point(this.curve);var e=this.z.inverse(),t=e.square();return new h.ecc.point(this.curve,this.x.mul(t).fullReduce(),this.y.mul(t.mul(e)).fullReduce())},mult:function(e,t){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs);var r,n,i=new h.ecc.point(this.curve).toJac(),a=t.multiples();for(r=e.length-1;r>=0;r--)for(n=h.bn.prototype.radix-4;n>=0;n-=4)i=i.doubl().doubl().doubl().doubl().add(a[15&e[r]>>n]);return i},mult2:function(e,t,r,n){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs),"number"==typeof r?r=[r]:r.limbs!==o&&(r=r.normalize().limbs);var i,a=new h.ecc.point(this.curve).toJac();t=t.multiples();var s,c,u=n.multiples();for(n=Math.max(e.length,r.length)-1;n>=0;n--)for(s=0|e[n],c=0|r[n],i=h.bn.prototype.radix-4;i>=0;i-=4)a=a.doubl().doubl().doubl().doubl().add(t[15&s>>i]).add(u[15&c>>i]);return a},isValid:function(){var e=this.z.square(),t=e.square(),e=t.mul(e);return this.y.square().equals(this.curve.b.mul(e).add(this.x.mul(this.curve.a.mul(t).add(this.x.square()))))}},h.ecc.curve=function(e,t,r,n,i,a){this.field=e,this.r=new h.bn(t),this.a=new e(r),this.b=new e(n),this.G=new h.ecc.point(this,new e(i),new e(a))},h.ecc.curve.prototype.fromBits=function(e){var t=h.bitArray,r=-8&this.field.prototype.exponent+7;if(e=new h.ecc.point(this,this.field.fromBits(t.bitSlice(e,0,r)),this.field.fromBits(t.bitSlice(e,r,2*r))),!e.isValid())throw new h.exception.corrupt("not on the curve!");return e},h.ecc.curves={c192:new h.ecc.curve(h.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new h.ecc.curve(h.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new h.ecc.curve(h.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new h.ecc.curve(h.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),k192:new h.ecc.curve(h.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new h.ecc.curve(h.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new h.ecc.curve(h.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},h.ecc.P=function(e){h.ecc[e]={publicKey:function(e,t){this.f=e,this.i=e.r.bitLength(),this.A=t instanceof Array?e.fromBits(t):t,this.get=function(){var e=this.A.toBits(),t=h.bitArray.bitLength(e),r=h.bitArray.bitSlice(e,0,t/2),e=h.bitArray.bitSlice(e,t/2);return{x:r,y:e}}},secretKey:function(e,t){this.f=e,this.i=e.r.bitLength(),this.t=t,this.get=function(){return this.t.toBits()}},generateKeys:function(t,r,n){if(t===o&&(t=256),"number"==typeof t&&(t=h.ecc.curves["c"+t],t===o))throw new h.exception.invalid("no such curve");return n===o&&(n=h.bn.random(t.r,r)),r=t.G.mult(n),{pub:new h.ecc[e].publicKey(t,r),sec:new h.ecc[e].secretKey(t,n)}}}},h.ecc.P("elGamal"),h.ecc.elGamal.publicKey.prototype={kem:function(e){e=h.bn.random(this.f.r,e);var t=this.f.G.mult(e).toBits();return{key:h.hash.sha256.hash(this.A.mult(e).toBits()),tag:t}}},h.ecc.elGamal.secretKey.prototype={unkem:function(e){return h.hash.sha256.hash(this.f.fromBits(e).mult(this.t).toBits())},dh:function(e){return h.hash.sha256.hash(e.A.mult(this.t).toBits())}},h.ecc.P("ecdsa"),h.ecc.ecdsa.secretKey.prototype={sign:function(e,t,r,n){h.bitArray.bitLength(e)>this.i&&(e=h.bitArray.clamp(e,this.i));var i=this.f.r,a=i.bitLength();return n=n||h.bn.random(i.sub(1),t).add(1),t=this.f.G.mult(n).x.mod(i),e=h.bn.fromBits(e).add(t.mul(this.t)),r=r?e.inverseMod(i).mul(n).mod(i):e.mul(n.inverseMod(i)).mod(i),h.bitArray.concat(t.toBits(a),r.toBits(a))}},h.ecc.ecdsa.publicKey.prototype={verify:function(e,t,r){h.bitArray.bitLength(e)>this.i&&(e=h.bitArray.clamp(e,this.i));var n=h.bitArray,i=this.f.r,a=this.i,s=h.bn.fromBits(n.bitSlice(t,0,a)),n=h.bn.fromBits(n.bitSlice(t,a,2*a)),u=r?n:n.inverseMod(i),a=h.bn.fromBits(e).mul(u).mod(i),u=s.mul(u).mod(i),a=this.f.G.mult2(a,u,this.A).x;if(s.equals(0)||n.equals(0)||s.greaterEquals(i)||n.greaterEquals(i)||!a.equals(s)){if(r===o)return this.verify(e,t,c);throw new h.exception.corrupt("signature didn't check out")}return c}},function(){var r,n,i,a;(function(){var e={},t={};r=function(t,r,n){e[t]={deps:r,callback:n}},a=i=n=function(r){function i(e){if("."!==e.charAt(0))return e;for(var t=e.split("/"),n=r.split("/").slice(0,-1),i=0,a=t.length;a>i;i++){var s=t[i];if(".."===s)n.pop();else{if("."===s)continue;n.push(s)}}return n.join("/")}if(a._eak_seen=e,t[r])return t[r];if(t[r]={},!e[r])throw Error("Could not find module "+r);for(var s,o=e[r],c=o.deps,u=o.callback,h=[],f=0,l=c.length;l>f;f++)"exports"===c[f]?h.push(s={}):h.push(n(i(c[f])));var p=u.apply(this,h);return t[r]=s||p}})(),r("promise/all",["./utils","exports"],function(e,t){"use strict";function r(e){var t=this;if(!n(e))throw new TypeError("You must pass an array to all.");return new t(function(t,r){function n(e){return function(t){a(e,t)}}function a(e,r){o[e]=r,0===--c&&t(o)}var s,o=[],c=e.length;0===c&&t([]);for(var u=0;e.length>u;u++)s=e[u],s&&i(s.then)?s.then(n(u),r):a(u,s)})}var n=e.isArray,i=e.isFunction;t.all=r}),r("promise/asap",["exports"],function(r){"use strict";function n(){return function(){process.nextTick(s)}}function i(){var e=0,t=new h(s),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function a(){return function(){f.setTimeout(s,1)}}function s(){for(var e=0;l.length>e;e++){var t=l[e],r=t[0],n=t[1];r(n)}l=[]}function o(e,t){var r=l.push([e,t]);1===r&&c()}var c,u=e!==t?e:{},h=u.MutationObserver||u.WebKitMutationObserver,f="undefined"!=typeof global?global:this,l=[];c="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?n():h?i():a(),r.asap=o
}),r("promise/cast",["exports"],function(e){"use strict";function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.cast=t}),r("promise/config",["exports"],function(e){"use strict";function r(e,r){return 2!==arguments.length?n[e]:(n[e]=r,t)}var n={instrument:!1};e.config=n,e.configure=r}),r("promise/polyfill",["./promise","./utils","exports"],function(t,r,n){"use strict";function i(){var t="Promise"in e&&"cast"in e.Promise&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),s(t)}();t||(e.Promise=a)}var a=t.Promise,s=r.isFunction;n.polyfill=i}),r("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(e,r,n,i,a,s,o,c,u){"use strict";function h(e){if(!D(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof h))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],f(e,this)}function f(e,t){function r(e){m(t,e)}function n(e){y(t,e)}try{e(r,n)}catch(i){n(i)}}function l(e,t,r,n){var i,a,s,o,c=D(r);if(c)try{i=r(n),s=!0}catch(u){o=!0,a=u}else i=n,s=!0;g(t,i)||(c&&s?m(t,i):o?y(t,a):e===R?m(t,i):e===L&&y(t,i))}function p(e,t,r,n){var i=e._subscribers,a=i.length;i[a]=t,i[a+R]=r,i[a+L]=n}function d(e,t){for(var r,n,i=e._subscribers,a=e._detail,s=0;i.length>s;s+=3)r=i[s],n=i[s+t],l(t,r,n,a);e._subscribers=null}function g(e,r){var n,i=null;try{if(e===r)throw new TypeError("A promises callback cannot return that same promise.");if(S(r)&&(i=r.then,D(i)))return i.call(r,function(i){return n?!0:(n=!0,r!==i?m(e,i):b(e,i),t)},function(r){return n?!0:(n=!0,y(e,r),t)}),!0}catch(a){return n?!0:(y(e,a),!0)}return!1}function m(e,t){e===t?b(e,t):g(e,t)||b(e,t)}function b(e,t){e._state===I&&(e._state=O,e._detail=t,w.async(v,e))}function y(e,t){e._state===I&&(e._state=O,e._detail=t,w.async(A,e))}function v(e){d(e,e._state=R)}function A(e){d(e,e._state=L)}var w=e.config;e.configure;var S=r.objectOrFunction,D=r.isFunction;r.now;var C=n.cast,G=i.all,M=a.race,x=s.resolve,N=o.reject,E=c.asap;w.async=E;var I=void 0,O=0,R=1,L=2;h.prototype={constructor:h,_state:t,_detail:t,_subscribers:t,then:function(e,t){var r=this,n=new this.constructor(function(){});if(this._state){var i=arguments;w.async(function(){l(r._state,n,i[r._state-1],r._detail)})}else p(this,n,e,t);return n},"catch":function(e){return this.then(null,e)}},h.all=G,h.cast=C,h.race=M,h.resolve=x,h.reject=N,u.Promise=h}),r("promise/race",["./utils","exports"],function(e,t){"use strict";function r(e){var t=this;if(!n(e))throw new TypeError("You must pass an array to race.");return new t(function(t,r){for(var n,i=0;e.length>i;i++)n=e[i],n&&"function"==typeof n.then?n.then(t,r):t(n)})}var n=e.isArray;t.race=r}),r("promise/reject",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t,r){r(e)})}e.reject=t}),r("promise/resolve",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t){t(e)})}e.resolve=t}),r("promise/utils",["exports"],function(e){"use strict";function t(e){return r(e)||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}var i=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=t,e.isFunction=r,e.isArray=n,e.now=i}),n("promise/polyfill").polyfill()}(),AeroGear.ajax=function(e){return new Promise(function(t,r){e=e||{};var n,i,a=new XMLHttpRequest,s=this,o=(e.type||"GET").toUpperCase(),c=(e.dataType||"json").toLowerCase(),u=(e.accept||"application/json").toLowerCase(),h=(e.contentType||"application/json").toLowerCase(),f=[],l=e.url,p=e.data;if(e.params)if("GET"===o||"POST"===o&&"application/x-www-form-urlencoded"===h)for(i in e.params)f.push(encodeURIComponent(i)+"="+encodeURIComponent(e.params[i]||""));else"application/json"===h&&(p=p||{},p.params=p.params||{},AeroGear.extend(p.params,e.params));if("application/x-www-form-urlencoded"===h){if(p)for(i in p)f.push(encodeURIComponent(i)+"="+encodeURIComponent(p[i]));p=f.join("&")}if("GET"===o&&f.length>0&&(l+="?"+f.join("&")),a.open(o,l,!0,e.username,e.password),a.responseType=c,a.setRequestHeader("Content-Type",h),a.setRequestHeader("Accept",u),e.headers)for(n in e.headers)a.setRequestHeader(n,e.headers[n]);a.onload=function(){var e=400>a.status?"success":"error",n=s._createPromiseValue(a,e);return"success"===e?t(n):r(n)},a.onerror=function(){var e="error";r(s._createPromiseValue(a,e))},this._createPromiseValue=function(e,t){var r=e.statusText||t,n="text"===c||""===c?e.responseText:e.response;return{data:n,statusText:r,agXHR:e}},a.send(p)})},AeroGear.DataManager=function(e){return this instanceof AeroGear.DataManager?(this.add=function(e){e=e||{};var t,r,n,i,a;e=Array.isArray(e)?e:[e],e=e.map(function(e){if(a=e.settings||{},n=a.fallback===!1?!1:!0,n&&(i=a.preferred?a.preferred:AeroGear.DataManager.preferred,"string"!=typeof e&&(r=e.type||"Memory",!(r in AeroGear.DataManager.validAdapters))))for(t=0;i.length>t;t++)if(i[t]in AeroGear.DataManager.validAdapters)return("IndexedDB"===r||"WebSQL"===r)&&(e.settings=AeroGear.extend(e.settings||{},{async:!0})),e.type=i[t],e;return e},this),AeroGear.Core.call(this),this.add(e),this.add=this._add},this._add=this.add,this.remove=function(e){AeroGear.Core.call(this),this.remove(e),this.remove=this._remove},this._remove=this.remove,this.lib="DataManager",this.type=e?e.type||"Memory":"Memory",this.collectionName="stores",this.add(e),t):new AeroGear.DataManager(e)},AeroGear.DataManager.prototype=AeroGear.Core,AeroGear.DataManager.constructor=AeroGear.DataManager,AeroGear.DataManager.validAdapters={},AeroGear.DataManager.preferred=["IndexedDB","WebSQL","SessionLocal","Memory"],AeroGear.DataManager.validateAdapter=function(e,t){t.isValid()&&(AeroGear.DataManager.validAdapters[e]=t)},AeroGear.DataManager.adapters={},AeroGear.DataManager.STATUS_NEW=1,AeroGear.DataManager.STATUS_MODIFIED=2,AeroGear.DataManager.STATUS_REMOVED=0,AeroGear.DataManager.adapters.base=function(t,r){if(this instanceof AeroGear.DataManager.adapters.base)throw"Invalid instantiation of base class AeroGear.DataManager.adapters.base";r=r||{};var n=null,i=r.recordId?r.recordId:"id",a=r.crypto||{},s=a.options||{};this.getData=function(){return n||[]},this.setData=function(e){n=e},this.getRecordId=function(){return i},this.encrypt=function(r){var n;return a.agcrypto?(s.data=h.codec.utf8String.toBits(JSON.stringify(r)),n={id:r[i],data:a.agcrypto.encrypt(s)},e.localStorage.setItem("ag-"+t+"-IV",JSON.stringify({id:a.agcrypto.getIV()})),n):r},this.decrypt=function(r,n){var i,o;return a.agcrypto?(o=JSON.parse(e.localStorage.getItem("ag-"+t+"-IV"))||{},s.IV=o.id,r=Array.isArray(r)?r:[r],i=r.map(function(e){return s.data=e.data,JSON.parse(h.codec.utf8String.fromBits(a.agcrypto.decrypt(s)))}),n?i[0]:i):r}},AeroGear.DataManager.adapters.Memory=function(e,r){return this instanceof AeroGear.DataManager.adapters.Memory?(AeroGear.DataManager.adapters.base.apply(this,arguments),this.emptyData=function(){this.setData(null)},this.addDataRecord=function(e){this.getData().push(e)},this.updateDataRecord=function(e,t){this.getData()[e]=t},this.removeDataRecord=function(e){this.getData().splice(e,1)},this.open=function(){return Promise.resolve()},this.close=function(){},this.traverseObjects=function(e,t,r){for(;"object"==typeof t&&r;)e=Object.keys(t)[0],t=t[e],r=r[e];return t===r?!0:!1},t):new AeroGear.DataManager.adapters.Memory(e,r)},AeroGear.DataManager.adapters.Memory.isValid=function(){return!0},AeroGear.DataManager.adapters.Memory.prototype.read=function(e){var t={};return t[this.getRecordId()]=e,e?this.filter(t).then(function(e){return e}):Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.save=function(e,t){var r=!1;if(e=Array.isArray(e)?e:[e],t&&t.reset)this.setData(e);else if(this.getData()&&0!==this.getData().length)for(var n=0;e.length>n;n++){for(var i in this.getData())if(this.getData()[i][this.getRecordId()]===e[n][this.getRecordId()]){this.updateDataRecord(i,e[n]),r=!0;break}r||this.addDataRecord(e[n]),r=!1}else this.setData(e);return Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.remove=function(e){var t,r,n;if(!e)return this.emptyData(),Promise.resolve(this.getData());e=Array.isArray(e)?e:[e];for(var i=0;e.length>i;i++){if("string"==typeof e[i]||"number"==typeof e[i])t=e[i];else{if(!e)continue;t=e[i][this.getRecordId()]}r=this.getData(!0);for(n in r)r[n][this.getRecordId()]===t&&this.removeDataRecord(n)}return Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.filter=function(e,t){var r,n,i,a,s=this;return e?(r=this.getData().filter(function(r){var o,c,u=t?!1:!0,h=Object.keys(e);for(n=0;h.length>n;n++){if(e[h[n]].data)for(o=e[h[n]],c=o.matchAny?!1:!0,i=0;o.data.length>i;i++)if(Array.isArray(r[h[n]]))if(r[h[n]].length){if(t||o.matchAny){for(a=0;r[h[n]].length>a;a++)if(o.data[i]===r[h[n]][a]){c=!0;break}}else if(r[h[n]].length!==o.data.length)c=!1;else for(a=0;r[h[n]].length>a;a++)if(o.data[a]!==r[h[n]][a]){c=!1;break}}else c=!1;else if("object"==typeof o.data[i]){if(o.matchAny&&s.traverseObjects(h[n],o.data[i],r[h[n]])){c=!0;break}if(!o.matchAny&&!s.traverseObjects(h[n],o.data[i],r[h[n]])){c=!1;break}}else{if(o.matchAny&&o.data[i]===r[h[n]]){c=!0;break}if(!o.matchAny&&o.data[i]!==r[h[n]]){c=!1;break}}else if(Array.isArray(r[h[n]]))if(c=t?!1:!0,r[h[n]].length)for(i=0;r[h[n]].length>i;i++){if(t&&e[h[n]]===r[h[n]][i]){c=!0;break}if(!t&&e[h[n]]!==r[h[n]][i]){c=!1;break}}else c=!1;else c="object"==typeof e[h[n]]?s.traverseObjects(h[n],e[h[n]],r[h[n]]):e[h[n]]===r[h[n]]?!0:!1;if(t&&c){u=!0;break}if(!t&&!c){u=!1;break}}return u}),Promise.resolve(r)):(r=this.getData()||[],Promise.resolve(r))},AeroGear.DataManager.validateAdapter("Memory",AeroGear.DataManager.adapters.Memory),AeroGear.DataManager.adapters.SessionLocal=function(t,r){if(!(this instanceof AeroGear.DataManager.adapters.SessionLocal))return new AeroGear.DataManager.adapters.SessionLocal(t,r);AeroGear.DataManager.adapters.Memory.apply(this,arguments);var n=r.storageType||"sessionStorage",i=t,a=document.location.pathname.replace(/[\/\.]/g,"-"),s=i+a,o=e[n].getItem(s),c=o?this.decrypt(JSON.parse(o),!0):null;c&&AeroGear.DataManager.adapters.Memory.prototype.save.call(this,c,!0),this.getStoreType=function(){return n},this.getStoreKey=function(){return s}},AeroGear.DataManager.adapters.SessionLocal.isValid=function(){try{return!(!e.localStorage||!e.sessionStorage)}catch(t){return!1}},AeroGear.DataManager.adapters.SessionLocal.prototype=Object.create(new AeroGear.DataManager.adapters.Memory,{save:{value:function(t,r){var n=this,i=r&&r.reset?r.reset:!1,a=e[this.getStoreType()].getItem(this.getStoreKey());return AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[arguments[0],{reset:i}]).then(function(t){try{e[n.getStoreType()].setItem(n.getStoreKey(),JSON.stringify(n.encrypt(t)))}catch(r){return a=a?JSON.parse(a):[],AeroGear.DataManager.adapters.Memory.prototype.save.apply(n,[a,{reset:i}]).then(function(){return Promise.reject()})}return t})},enumerable:!0,configurable:!0,writable:!0},remove:{value:function(){var t=this;return AeroGear.DataManager.adapters.Memory.prototype.remove.apply(this,arguments).then(function(r){e[t.getStoreType()].setItem(t.getStoreKey(),JSON.stringify(t.encrypt(r)))})},enumerable:!0,configurable:!0,writable:!0}}),AeroGear.DataManager.validateAdapter("SessionLocal",AeroGear.DataManager.adapters.SessionLocal),AeroGear.DataManager.adapters.IndexedDB=function(r,n){if(!e.indexedDB)throw"Your browser doesn't support IndexedDB";if(!(this instanceof AeroGear.DataManager.adapters.IndexedDB))return new AeroGear.DataManager.adapters.IndexedDB(r,n);AeroGear.DataManager.adapters.base.apply(this,arguments),n=n||{};var i,a=n.auto===t||n.auto?!0:!1;this.getDatabase=function(){return i},this.setDatabase=function(e){i=e},this.getStoreName=function(){return r},this.getAsync=function(){return!0},this.run=function(e){var t=this;if(i)e.call(this,i);else{if(!a)throw"Database not opened";this.open().then(function(r,n){if("error"===n)throw"Database not opened";e.call(t,i)})}}},AeroGear.DataManager.adapters.IndexedDB.isValid=function(){return!!e.indexedDB},AeroGear.DataManager.adapters.IndexedDB.prototype.open=function(){var t,r,n=this,i=this.getStoreName(),a=this.getRecordId();return new Promise(function(s,o){t=e.indexedDB.open(i),t.onsuccess=function(e){r=e.target.result,n.setDatabase(r),s(r)},t.onerror=function(e){o(e)},t.onupgradeneeded=function(e){r=e.target.result,r.createObjectStore(i,{keyPath:a})}})},AeroGear.DataManager.adapters.IndexedDB.prototype.read=function(e){var r,n,i,a,s=this,o=[],c=this.getStoreName();return new Promise(function(u,h){s.run.call(s,function(f){return f.objectStoreNames.contains(c)?(r=f.transaction(c),n=r.objectStore(c),e?(a=n.get(e),a.onsuccess=function(){o.push(a.result)}):(i=n.openCursor(),i.onsuccess=function(e){var t=e.target.result;t&&(o.push(t.value),t.continue())}),r.oncomplete=function(){u(s.decrypt(o))},r.onerror=function(e){h(e)},t):u([])})})},AeroGear.DataManager.adapters.IndexedDB.prototype.save=function(e,t){t=t||{};var r,n,i=this,a=this.getStoreName(),s=0;return new Promise(function(o,c){i.run.call(i,function(u){if(r=u.transaction(a,"readwrite"),n=r.objectStore(a),t.reset&&n.clear(),Array.isArray(e))for(s;e.length>s;s++)n.put(this.encrypt(e[s]));else n.put(this.encrypt(e));r.oncomplete=function(){i.read().then(function(e){o(e)}).catch(function(){c(e,status)})},r.onerror=function(e){c(e)}})})},AeroGear.DataManager.adapters.IndexedDB.prototype.remove=function(e){var t,r,n=this,i=this.getDatabase(),a=this.getStoreName(),s=0;return new Promise(function(o,c){n.run.call(n,function(){if(r=i.transaction(a,"readwrite"),t=r.objectStore(a),e)for(e=Array.isArray(e)?e:[e],s;e.length>s;s++)if("string"==typeof e[s]||"number"==typeof e[s])t.delete(e[s]);else{if(!e)continue;t.delete(e[s][this.getRecordId()])}else t.clear();r.oncomplete=function(){n.read().then(function(e){o(e)}).catch(function(e){c(e)})},r.onerror=function(e){c(e)}})})},AeroGear.DataManager.adapters.IndexedDB.prototype.filter=function(e,t){var r=this;return new Promise(function(n,i){r.run.call(r,function(){this.read().then(function(i){AeroGear.DataManager.adapters.Memory.prototype.save.call(r,i,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(r,e,t).then(function(e){n(e)})}).catch(function(e){i(e)})})})},AeroGear.DataManager.adapters.IndexedDB.prototype.close=function(){var e=this.getDatabase();e&&e.close()},AeroGear.DataManager.validateAdapter("IndexedDB",AeroGear.DataManager.adapters.IndexedDB),AeroGear.DataManager.adapters.WebSQL=function(r,n){if(!e.openDatabase)throw"Your browser doesn't support WebSQL";if(!(this instanceof AeroGear.DataManager.adapters.WebSQL))return new AeroGear.DataManager.adapters.WebSQL(r,n);AeroGear.DataManager.adapters.base.apply(this,arguments),n=n||{};var i,a=n.auto===t||n.auto?!0:!1;this.getDatabase=function(){return i},this.setDatabase=function(e){i=e},this.getStoreName=function(){return r},this.getAsync=function(){return!0},this.run=function(e){var t=this;if(i)e.call(this,i);else{if(!a)throw"Database not opened";this.open().then(function(){e.call(t,i)}).catch(function(){throw"Database not opened"})}}},AeroGear.DataManager.adapters.WebSQL.isValid=function(){return!!e.openDatabase},AeroGear.DataManager.adapters.WebSQL.prototype.open=function(){var t,r,n,i=this,a="1",s=2097152,o=this.getRecordId(),c=this.getStoreName();return t=e.openDatabase(c,a,"AeroGear WebSQL Store",s),new Promise(function(e,a){n=function(e,t){a(t)},r=function(){i.setDatabase(t),e(t)},t.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS '"+c+"' ( "+o+" REAL UNIQUE, json)",[],r,n)})})},AeroGear.DataManager.adapters.WebSQL.prototype.close=function(){},AeroGear.DataManager.adapters.WebSQL.prototype.read=function(e){var t,r,n,i=this,a=[],s=[],o=this.getStoreName(),c=this.getDatabase(),u=0;return new Promise(function(h,f){i.run.call(i,function(){n=function(e,t){f(t)},r=function(e,t){var r=t.rows.length;for(u;r>u;u++)a.push(JSON.parse(t.rows.item(u).json));h(i.decrypt(a))},t="SELECT * FROM '"+o+"'",e&&(t+=" WHERE ID = ?",s=[e]),c.transaction(function(e){e.executeSql(t,s,r,n)})})})},AeroGear.DataManager.adapters.WebSQL.prototype.save=function(e,t){t=t||{};var r,n,i=this,a=this.getRecordId(),s=this.getStoreName();return new Promise(function(o,c){i.run.call(i,function(u){r=function(e,t){c(t)},n=function(){i.read().then(function(e){o(e)}).catch(function(e){c(e)})},e=Array.isArray(e)?e:[e],u.transaction(function(r){t.reset&&(r.executeSql("DROP TABLE "+s),r.executeSql("CREATE TABLE IF NOT EXISTS '"+s+"' ( "+a+" REAL UNIQUE, json)")),e.forEach(function(e){e=i.encrypt(e),r.executeSql("INSERT OR REPLACE INTO '"+s+"' ( id, json ) VALUES ( ?, ? ) ",[e[a],JSON.stringify(e)])})},r,n)})})},AeroGear.DataManager.adapters.WebSQL.prototype.remove=function(e){var t,r,n,i=this,a=this.getStoreName(),s=0;return new Promise(function(o,c){i.run.call(i,function(u){n=function(e,t){c(t)},r=function(){i.read().then(function(e){o(e)}).catch(function(e){c(e)})},t="DELETE FROM '"+a+"'",e?(e=Array.isArray(e)?e:[e],u.transaction(function(r){for(s;e.length>s;s++)if("string"==typeof e[s]||"number"==typeof e[s])r.executeSql(t+" WHERE ID = ? ",[e[s]]);else{if(!e)continue;r.executeSql(t+" WHERE ID = ? ",[e[s][this.getRecordId()]])}},n,r)):u.transaction(function(e){e.executeSql(t,[],r,n)})})})},AeroGear.DataManager.adapters.WebSQL.prototype.filter=function(e,t){var r=this;return new Promise(function(n,i){r.run.call(r,function(){this.read().then(function(i){AeroGear.DataManager.adapters.Memory.prototype.save.call(r,i,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(r,e,t).then(function(e){n(e)})}).catch(function(e){i(e)})})})},AeroGear.DataManager.validateAdapter("WebSQL",AeroGear.DataManager.adapters.WebSQL),AeroGear.Authorization=function(e){return this instanceof AeroGear.Authorization?(AeroGear.Core.call(this),this.lib="Authorization",this.type=e?e.type||"OAuth2":"OAuth2",this.collectionName="services",this.add(e),t):new AeroGear.Authorization(e)},AeroGear.Authorization.prototype=AeroGear.Core,AeroGear.Authorization.constructor=AeroGear.Authorization,AeroGear.Authorization.adapters={},AeroGear.Authorization.adapters.OAuth2=function(e,t){if(!(this instanceof AeroGear.Authorization.adapters.OAuth2))return new AeroGear.Authorization.adapters.OAuth2(e,t);t=t||{};var r,n=uuid(),i=t.clientId,a=t.redirectURL,s=t.validationEndpoint,o=t.scopes,c="ag-oauth2-"+i,u=t.authEndpoint+"?"+"response_type=token"+"&redirect_uri="+encodeURIComponent(a)+"&scope="+encodeURIComponent(o)+"&state="+encodeURIComponent(n)+"&client_id="+encodeURIComponent(i);this.getAccessToken=function(){return localStorage[c]&&(r=JSON.parse(localStorage[c]).accessToken),r},this.getState=function(){return n},this.getClientId=function(){return i},this.getLocalStorageName=function(){return c},this.getValidationEndpoint=function(){return s},this.enrichErrorAndRethrow=function(e){throw e=e||{},AeroGear.extend(e,{authURL:u})},this.parseQueryString=function(e){for(var t,r={},n=e.substr(e.indexOf("#")+1),i=/([^&=]+)=([^&]*)/g;t=i.exec(n);)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r}},AeroGear.Authorization.adapters.OAuth2.prototype.validate=function(e){var r,n=this,i=this.parseQueryString(e),a=this.getState();return r=new Promise(function(e,r){return i.state!==a?(r({error:"invalid_request",state:a,error_description:"state's do not match"}),t):(n.getValidationEndpoint()?AeroGear.ajax({url:n.getValidationEndpoint()+"?access_token="+i.access_token}).then(function(a){return n.getClientId()!==a.agXHR.response.audience?(r({error:"invalid_token"}),t):(localStorage.setItem(n.getLocalStorageName(),JSON.stringify({accessToken:i.access_token})),e(i),t)}).catch(function(){r({error:"invalid_token"})}):r(i),t)}),r.catch(this.enrichErrorAndRethrow)},AeroGear.Authorization.adapters.OAuth2.prototype.execute=function(e){e=e||{};var t=e.url+"?access_token="+this.getAccessToken(),r="application/x-www-form-urlencoded";return AeroGear.ajax({url:t,type:e.type,contentType:r}).catch(this.enrichErrorAndRethrow)},AeroGear.Notifier=function(e){return this instanceof AeroGear.Notifier?(AeroGear.Core.call(this),this.lib="Notifier",this.type=e?e.type||"vertx":"vertx",this.collectionName="clients",this.add(e),t):new AeroGear.Notifier(e)},AeroGear.Notifier.prototype=AeroGear.Core,AeroGear.Notifier.constructor=AeroGear.Notifier,AeroGear.Notifier.adapters={},AeroGear.Notifier.CONNECTING=0,AeroGear.Notifier.CONNECTED=1,AeroGear.Notifier.DISCONNECTING=2,AeroGear.Notifier.DISCONNECTED=3,AeroGear.Notifier.adapters.base=function(e,t){if(this instanceof AeroGear.Notifier.adapters.base)throw"Invalid instantiation of base class AeroGear.Notifier.adapters.base";t=t||{};var r=t.connectURL||"",n=t.channels||[],i=!!t.autoConnect||n.length,a=AeroGear.Notifier.CONNECTING,s=null;this.getConnectURL=function(){return r},this.setConnectURL=function(e){r=e},this.getChannels=function(){return n},this.addChannel=function(e){n.push(e)},this.getChannelIndex=function(e){for(var t=0;n.length>t;t++)if(n[t].address===e)return t;return-1},this.removeChannel=function(e){var t=this.getChannelIndex(e.address);t>=0&&n.splice(t,1)},this.getState=function(){return a},this.setState=function(e){a=e},this.getClient=function(){return s},this.setClient=function(e){s=e},!i&&!n.length||t.login||t.password||this.connect({url:r,onConnect:t.onConnect,onDisconnect:t.onDisconnect,onConnectError:t.onConnectError,onMessage:t.onMessage})},AeroGear.Notifier.adapters.SimplePush=function(e,t){if(!(this instanceof AeroGear.Notifier.adapters.SimplePush))return new AeroGear.Notifier.adapters.SimplePush(e,t);t=t||{};var r=e,n=t.connectURL||"",i=t.useNative||!1,a=null,s=JSON.parse(localStorage.getItem("ag-push-store")||"{}");s.channels=s.channels||[];for(var o in s.channels)s.channels[o].state="available";localStorage.setItem("ag-push-store",JSON.stringify(s)),this.getSettings=function(){return t},this.getName=function(){return r},this.getConnectURL=function(){return n},this.setConnectURL=function(e){n=e},this.getUseNative=function(){return i},this.getClient=function(){return a},this.setClient=function(e){a=e},this.getPushStore=function(){return s},this.setPushStore=function(e){s=e,localStorage.setItem("ag-push-store",JSON.stringify(e))},this.processMessage=function(e){var t,r,n;if("register"===e.messageType&&200===e.status)t={channelID:e.channelID,version:e.version,state:"used",pushEndpoint:e.pushEndpoint},s.channels=this.updateChannel(s.channels,t),this.setPushStore(s),t.pushEndpoint=e.pushEndpoint,jQuery(navigator.push).trigger(jQuery.Event(e.channelID+"-success",{target:{result:t.pushEndpoint}}));else{if("register"===e.messageType)throw"SimplePushRegistrationError";if("unregister"===e.messageType&&200===e.status)s.channels.splice(this.findChannelIndex(s.channels,"channelID",e.channelID),1),this.setPushStore(s);else{if("unregister"===e.messageType)throw"SimplePushUnregistrationError";if("notification"===e.messageType){r=e.updates,n=JSON.parse(localStorage.getItem("ag-push-store"));for(var i=0,o=r.length;o>i;i++){var c=n.channels.filter(function(e){return e.channelID===r[i].channelID});r[i].pushEndpoint=c?c[0].pushEndpoint:"",jQuery(navigator.push).trigger(jQuery.Event("push",{message:r[i]}))}e.messageType="ack",a.send(JSON.stringify(e))}}}},this.generateHello=function(){var e=s.channels,t={messageType:"hello",uaid:"",channelIDs:[]};if(s.uaid&&(t.uaid=s.uaid),e&&""!==t.uaid)for(var r=e.length,n=r-1;n>-1;n--)t.channelIDs.push(s.channels[n].channelID);return JSON.stringify(t)},this.findChannelIndex=function(e,t,r){for(var n=0;e.length>n;n++)if(e[n][t]===r)return n},this.updateChannel=function(e,t){for(var r=0;e.length>r;r++)if(e[r].channelID===t.channelID){e[r].version=t.version,e[r].state=t.state,e[r].pushEndpoint=t.pushEndpoint;break}return e},this.bindSubscribeSuccess=function(e,t){jQuery(navigator.push).off(e+"-success"),jQuery(navigator.push).on(e+"-success",function(e){t.onsuccess(e)})}},AeroGear.Notifier.adapters.SimplePush.prototype.connect=function(e){e=e||{};var r=this,n=this.getUseNative()?new WebSocket(e.url||this.getConnectURL()):new SockJS(e.url||this.getConnectURL(),t,e);n.onopen=function(){n.send(r.generateHello())},n.onerror=function(){e.onConnectError&&e.onConnectError.apply(this,arguments)},n.onmessage=function(t){var n=r.getPushStore();t=JSON.parse(t.data),"hello"===t.messageType?(t.uaid!==n.uaid&&(n.uaid=t.uaid,r.setPushStore(n)),e.onConnect&&e.onConnect(t)):r.processMessage(t)},n.onclose=function(){e.onClose&&e.onClose.apply(this,arguments)},this.setClient(n)},AeroGear.Notifier.adapters.SimplePush.prototype.disconnect=function(e){var t=this.getClient();t.close(),e&&e()},AeroGear.Notifier.adapters.SimplePush.prototype.subscribe=function(e,r){var n,i,a=!1,s=this.getClient(),o=this.getPushStore();r&&this.unsubscribe(this.getChannels()),e=Array.isArray(e)?e:[e],o.channels=o.channels||[],i=o.channels.length;for(var c=0;e.length>c;c++)i&&(n=this.findChannelIndex(o.channels,"state","available"),n!==t&&(this.bindSubscribeSuccess(o.channels[n].channelID,e[c].requestObject),e[c].channelID=o.channels[n].channelID,e[c].state="used",e[c].pushEndpoint=o.channels[n].pushEndpoint,setTimeout(function(e){return function(){jQuery(navigator.push).trigger(jQuery.Event(e.channelID+"-success",{target:{result:e.pushEndpoint}}))}}(e[c]),0),o.channels[n]=e[c],a=!0)),a||(e[c].channelID=e[c].channelID||uuid(),e[c].state="used",this.bindSubscribeSuccess(e[c].channelID,e[c].requestObject),s.send('{"messageType": "register", "channelID": "'+e[c].channelID+'"}'),o.channels.push(e[c])),a=!1;this.setPushStore(o)},AeroGear.Notifier.adapters.SimplePush.prototype.unsubscribe=function(e){var t,r=this.getClient(),n=JSON.parse(localStorage.getItem("ag-push-store"));e=Array.isArray(e)?e:[e];for(var i=0;e.length>i;i++)t=n.channels.filter(function(t){return t.pushEndpoint===e[i]}),r.send('{"messageType": "unregister", "channelID": "'+t[0].channelID+'"}')},AeroGear.Notifier.adapters.vertx=function(e,r){return this instanceof AeroGear.Notifier.adapters.vertx?(r=r||{},AeroGear.Notifier.adapters.base.apply(this,arguments),t):new AeroGear.Notifier.adapters.vertx(e,r)},AeroGear.Notifier.adapters.vertx.prototype.connect=function(e){e=e||{};var t=this,r=new vertx.EventBus(e.url||this.getConnectURL(),e);r.onopen=function(){var r=t.getChannels().slice(0);t.setState(AeroGear.Notifier.CONNECTED),t.subscribe(r,!0),e.onConnect&&e.onConnect.apply(this,arguments)},r.onclose=function(){t.getState()===AeroGear.Notifier.DISCONNECTING?(t.setState(AeroGear.Notifier.DISCONNECTED),e.onDisconnect&&e.onDisconnect.apply(this,arguments)):e.onConnectError&&e.onConnectError.apply(this,arguments)},this.setClient(r)},AeroGear.Notifier.adapters.vertx.prototype.disconnect=function(){var e=this.getClient();this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),e.close())},AeroGear.Notifier.adapters.vertx.prototype.subscribe=function(e,t){var r=this.getClient();t&&this.unsubscribe(this.getChannels()),e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)this.addChannel(e[n]),r.registerHandler(e[n].address,e[n].callback)},AeroGear.Notifier.adapters.vertx.prototype.unsubscribe=function(e){var t=this.getClient(),r=this.getChannels();e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)t.unregisterHandler(e[n].address,e[n].callback||r[this.getChannelIndex(e[n].address)].callback),this.removeChannel(e[n])},AeroGear.Notifier.adapters.vertx.prototype.send=function(e,t,r){var n=this.getClient();typeof t!==Boolean||r||(r=t,t=""),t=t||"",n[r?"publish":"send"](e,t)},AeroGear.Notifier.adapters.stompws=function(e,r){return this instanceof AeroGear.Notifier.adapters.stompws?(r=r||{},AeroGear.Notifier.adapters.base.apply(this,arguments),t):new AeroGear.Notifier.adapters.stompws(e,r)},AeroGear.Notifier.adapters.stompws.prototype.connect=function(e){e=e||{};var t=this,r=new Stomp.client(e.url||this.getConnectURL(),e.protocol||"v11.stomp"),n=function(){var r=t.getChannels().slice(0);t.setState(AeroGear.Notifier.CONNECTED),t.subscribe(r,!0),e.onConnect&&e.onConnect.apply(this,arguments)},i=function(){t.setState(AeroGear.Notifier.DISCONNECTED),e.onConnectError&&e.onConnectError.apply(this,arguments)};r.connect(e.login,e.password,n,i,e.host),this.setClient(r)},AeroGear.Notifier.adapters.stompws.prototype.disconnect=function(e){var t=this,r=this.getClient(),n=function(){t.getState()===AeroGear.Notifier.DISCONNECTING&&(t.setState(AeroGear.Notifier.DISCONNECTED),e&&e.apply(this,arguments))};this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),r.disconnect(n))},AeroGear.Notifier.adapters.stompws.prototype.subscribe=function(e,t){var r=this.getClient();t&&this.unsubscribe(this.getChannels()),e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)e[n].id=r.subscribe(e[n].address,e[n].callback),this.addChannel(e[n])},AeroGear.Notifier.adapters.stompws.prototype.debug=function(e){var t=this.getClient(),r=function(){e&&e.apply(this,arguments)};t&&(t.debug=r)},AeroGear.Notifier.adapters.stompws.prototype.unsubscribe=function(e){var t=this.getClient(),r=this.getChannels();e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)t.unsubscribe(e[n].id||r[this.getChannelIndex(e[n].address)].id),this.removeChannel(e[n])},AeroGear.Notifier.adapters.stompws.prototype.send=function(e,t){var r={},n=this.getClient();t=t||"",t.headers&&(r=t.headers,t=t.body),n.send(e,r,t)},AeroGear.Notifier.adapters.mqttws=function(e,t){if(!(this instanceof AeroGear.Notifier.adapters.mqttws))return new AeroGear.Notifier.adapters.mqttws(e,t);t=t||{},AeroGear.Notifier.adapters.base.apply(this,arguments);var r=t.clientId||"agClientId";this.getClientId=function(){return r},this.setClientId=function(e){r=e},this.processConnectOptions=function(e){return e.onConnect&&(e.onSuccess=e.onConnect,delete e.onConnect),e.onConnectError&&(e.onFailure=e.onConnectError,delete e.onConnectError),e.login&&(e.userName=e.login,delete e.login),e.url&&delete e.url,e.clientId&&delete e.clientId,e.onMessage&&delete e.onMessage,e},this.processURL=function(e){var t={},r=e.split("/"),n=r[0].split(":")[0],i=r[2].split(":"),a="/"+(r[3]||"mqtt");return t.hostname=i[0],t.port=Number(i[1])||("wss"===n?443:80),t.path=a,t}},AeroGear.Notifier.adapters.mqttws.prototype.connect=function(e){e=e||{};var t,r,n=this,i=e.onConnect,a=e.onConnectError;r=this.processURL(e.url||this.getConnectURL()),t=new Paho.MQTT.Client(r.hostname,r.port,r.path,e.clientId||this.getClientId()),e.onMessage&&(t.onMessageArrived=e.onMessage),e.onConnect=function(){var e=n.getChannels().slice(0);n.setState(AeroGear.Notifier.CONNECTED),n.subscribe(e,!0),i&&i.apply(this,arguments)},e.onConnectError=function(){n.setState(AeroGear.Notifier.DISCONNECTED),a&&a.apply(this,arguments)},t.connect(this.processConnectOptions(e)),this.setClient(t)},AeroGear.Notifier.adapters.mqttws.prototype.disconnect=function(){var e=this.getClient();this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),e.disconnect())},AeroGear.Notifier.adapters.mqttws.prototype.subscribe=function(e,t){var r=this.getClient();t&&this.unsubscribe(this.getChannels()),e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)this.addChannel(e[n]),r.subscribe(e[n].address,e[n].subscribeOptions||{})},AeroGear.Notifier.adapters.mqttws.prototype.unsubscribe=function(e){var t=this.getClient();e=Array.isArray(e)?e:[e];for(var r=0;e.length>r;r++)t.unsubscribe(e[r].address,e[r].unsubscribeOptions||{}),this.removeChannel(e[r])},AeroGear.Notifier.adapters.mqttws.prototype.send=function(e,t,r){var n=this.getClient();t=new Paho.MQTT.Message(t||""),t.destinationName=e,r&&(r.qos&&(t.qos=r.qos),r.retained&&(t.retained=r.retained),r.duplicate&&(t.duplicate=r.duplicate)),n.send(t)
},function(r){r.UnifiedPushClient=function(n,i,a){if(!n||!i||!a)throw"UnifiedPushClientException";return this instanceof r.UnifiedPushClient?(a="/"===a.substr(-1)?a:a+"/",this.registerWithPushServer=function(t){t=t||{};var s=t.metadata||{};if(!s.deviceToken)throw"UnifiedPushRegistrationException";return s.categories=Array.isArray(s.categories)?s.categories:s.categories?[s.categories]:[],r.ajax({contentType:"application/json",dataType:"json",type:"POST",url:a+"rest/registry/device",headers:{Authorization:"Basic "+e.btoa(n+":"+i)},data:JSON.stringify(s)})},this.unregisterWithPushServer=function(t){return r.ajax({contentType:"application/json",dataType:"json",type:"DELETE",url:a+"rest/registry/device/"+t,headers:{Authorization:"Basic "+e.btoa(n+":"+i)}})},t):new r.UnifiedPushClient(n,i,a)}}(AeroGear),function(r,n){r.SimplePushClient=function(i){if(!(this instanceof r.SimplePushClient))return new r.SimplePushClient(i);if(this.options=i||{},navigator.push&&this.options.useNative)return i.onConnect&&i.onConnect(),t;if(this.options.useNative)if("WebSocket"in e)this.options.simplePushServerURL="wss://push.services.mozilla.com";else{if(!this.options.simplePushServerURL)throw"SimplePushConfigurationError";this.options.useNative=!1}var a=this,s={onConnect:function(){navigator.push=function(){return{register:function(){var e={onsuccess:function(){}};if(!a.simpleNotifier)throw"SimplePushConnectionError";return a.simpleNotifier.subscribe({requestObject:e}),e},unregister:function(e){a.simpleNotifier.unsubscribe(e)},reconnect:function(){a.simpleNotifier.connect(s)}}}(),navigator.setMessageHandler=navigator.mozSetMessageHandler=function(e,t){n(navigator.push).on(e,function(e){var r=e.message;t.call(this,r)})},a.options.onConnect&&a.options.onConnect()},onClose:function(){a.simpleNotifier.disconnect(a.options.onClose)}};a.simpleNotifier=r.Notifier({name:"agPushNetwork",type:"SimplePush",settings:{connectURL:a.options.simplePushServerURL,useNative:a.options.useNative}}).clients.agPushNetwork,a.simpleNotifier.connect(s)}}(AeroGear,jQuery),AeroGear.Crypto=function(){if(!e.crypto||!e.crypto.getRandomValues)throw"Your browser does not support the Web Crypto API";if(!(this instanceof AeroGear.Crypto))return new AeroGear.Crypto;var t,r,n,i;this.getSalt=function(){return i},this.getIV=function(){return n},this.getPrivateKey=function(){return t},this.getPublicKey=function(){return r},this.getRandomValue=function(){var e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]},this.deriveKey=function(e,t){i=t||(i?i:this.getRandomValue());var r=h.codec.utf8String,n=2048;return h.misc.pbkdf2(e,r.toBits(i),n)},this.encrypt=function(e){e=e||{};var t=h.mode.gcm,r=new h.cipher.aes(e.key);return n=e.IV||(n?n:this.getRandomValue()),t.encrypt(r,e.data,n,e.aad,128)},this.decrypt=function(e){e=e||{};var t=h.mode.gcm,r=new h.cipher.aes(e.key);return t.decrypt(r,e.data,e.IV||n,e.aad,128)},this.hash=function(e){return h.hash.sha256.hash(e)},this.sign=function(e){e=e||{};var t=e.keys||h.ecc.ecdsa.generateKeys(192),r=h.hash.sha256.hash(e.message);return t.sec.sign(r)},this.verify=function(e){e=e||{};var t=h.hash.sha256.hash(e.message);return e.keys.pub.verify(t,e.signature)},this.KeyPair=function(e,n){var i,a;return e&&n?(t=e,r=n):(i=h.ecc.elGamal.generateKeys(192,0),a=i.pub.kem(),r=a.key,t=i.sec.unkem(a.tag)),this}}})(this);
//@ sourceMappingURL=aerogear.js.map