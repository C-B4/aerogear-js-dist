/*! AeroGear JavaScript Library - v1.1.2 - 2013-07-11
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,r,a=this[this.collectionName]||{};if(!e)return this;if("string"==typeof e)a[e]=AeroGear[this.lib].adapters[this.type](e);else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?a[r]=AeroGear[this.lib].adapters[this.type](r):a[r.name]=AeroGear[this.lib].adapters[r.type||this.type](r.name,r.settings||{});else a[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings||{});return this[this.collectionName]=a,this},this.remove=function(e){var t,r,a=this[this.collectionName]||{};if("string"==typeof e)delete a[e];else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?delete a[r]:delete a[r.name];else e&&delete a[e.name];return this[this.collectionName]=a,this}},AeroGear.isArray=function(e){return"[object Array]"==={}.toString.call(e)},AeroGear.Pipeline=function(e){return this instanceof AeroGear.Pipeline?(AeroGear.Core.call(this),this.lib="Pipeline",this.type=e?e.type||"Rest":"Rest",this.collectionName="pipes",this.add(e),t):new AeroGear.Pipeline(e)},AeroGear.Pipeline.prototype=AeroGear.Core,AeroGear.Pipeline.constructor=AeroGear.Pipeline,AeroGear.Pipeline.adapters={},AeroGear.Pipeline.adapters.Rest=function(e,r){if(!(this instanceof AeroGear.Pipeline.adapters.Rest))return new AeroGear.Pipeline.adapters.Rest(e,r);r=r||{};var a=r.endpoint||e,n={url:r.baseURL?r.baseURL+a:a,contentType:r.contentType||"application/json",dataType:r.dataType||"json"},o=r.recordId||"id",i=(r.authenticator||null,r.pageConfig),s=r.timeout?1e3*r.timeout:6e4;this.getAjaxSettings=function(){return n},this.getRecordId=function(){return o},this.getTimeout=function(){return s},this.getPageConfig=function(){return i},this.updatePageConfig=function(e,t){t?(i={},i.metadataLocation=e.metadataLocation?e.metadataLocation:"webLinking",i.previousIdentifier=e.previousIdentifier?e.previousIdentifier:"previous",i.nextIdentifier=e.nextIdentifier?e.nextIdentifier:"next",i.parameterProvider=e.parameterProvider?e.parameterProvider:null):jQuery.extend(i,e)},i&&this.updatePageConfig(i,!0),this.webLinkingPageParser=function(e){var r,a,n,o,s,c={};a=e.getResponseHeader("Link").split(",");for(var u in a){r=a[u].trim().split(";");for(var p in r)n=r[p].trim(),0===n.indexOf("<")&&n.lastIndexOf(">")===r[p].length-1?o=n.substr(1,n.length-2).split("?")[1]:0===n.indexOf("rel=")&&(n.indexOf(i.previousIdentifier)>=0?s=i.previousIdentifier:n.indexOf(i.nextIdentifier)>=0&&(s=i.nextIdentifier));s&&(c[s]=o,s=t)}return c},this.headerPageParser=function(e){var t=e.getResponseHeader(i.previousIdentifier),r=e.getResponseHeader(i.nextIdentifier),a={},n={};return i.parameterProvider?(a=i.parameterProvider(e),n[i.previousIdentifier]=a[i.previousIdentifier],n[i.nextIdentifier]=a[i.nextIdentifier]):(n[i.previousIdentifier]=t?t.split("?")[1]:null,n[i.nextIdentifier]=r?r.split("?")[1]:null),n},this.bodyPageParser=function(e){var t={},r={};return i.parameterProvider?(r=i.parameterProvider(e),t[i.previousIdentifier]=r[i.previousIdentifier],t[i.nextIdentifier]=r[i.nextIdentifier]):(t[i.previousIdentifier]=e[i.previousIdentifier],t[i.nextIdentifier]=e[i.nextIdentifier]),t},this.formatJSONError=function(e){if("json"===this.getAjaxSettings().dataType)try{e.responseJSON=JSON.parse(e.responseText)}catch(t){}return e}},AeroGear.Pipeline.adapters.Rest.prototype.read=function(e){var r,a,n,o,i=this,s=this.getRecordId(),c=this.getAjaxSettings(),u=this.getPageConfig();if(e=e?e:{},e.query=e.query?e.query:{},r=e[s]?c.url+"/"+e[s]:c.url,u&&e.paging!==!1){e.paging||(e.paging={offset:e.offsetValue||0,limit:e.limitValue||10}),e.query=e.query||{};for(var p in e.paging)e.query[p]=e.paging[p]}return a=function(r,a,n){var o;u&&e.paging!==!1&&(o=i[u.metadataLocation+"PageParser"]("body"===u.metadataLocation?r:n),["previous","next"].forEach(function(a){r[a]=function(e,r,a){return function(n){return a.paging=!0,a.offsetValue=a.limitValue=t,a.query=r,a.success=n&&n.success?n.success:a.success,a.error=n&&n.error?n.error:a.error,e.read(a)}}(i,o[u[a+"Identifier"]],e)})),e.success&&e.success.apply(this,arguments)},n=function(t){t=i.formatJSONError(t),e.error&&e.error.apply(this,arguments)},o={type:"GET",data:e.query,success:a,error:n,url:r,statusCode:e.statusCode,complete:e.complete,headers:e.headers,timeout:this.getTimeout()},e.jsonp&&(o.dataType="jsonp",o.jsonp=e.jsonp.callback?e.jsonp.callback:"callback",e.jsonp.customCallback&&(o.jsonpCallback=e.jsonp.customCallback)),jQuery.ajax(jQuery.extend({},this.getAjaxSettings(),o))},AeroGear.Pipeline.adapters.Rest.prototype.save=function(e,t){var r,a,n,o,i,s=this,c=this.getRecordId(),u=this.getAjaxSettings();return e=e||{},t=t||{},r=e[c]?"PUT":"POST",a=e[c]?u.url+"/"+e[c]:u.url,n=function(){t.success&&t.success.apply(this,arguments)},o=function(e){e=s.formatJSONError(e),t.error&&t.error.apply(this,arguments)},i=jQuery.extend({},u,{data:e,type:r,url:a,success:n,error:o,statusCode:t.statusCode,complete:t.complete,headers:t.headers,timeout:this.getTimeout()}),"application/json"===i.contentType&&i.data&&"string"!=typeof i.data&&(i.data=JSON.stringify(i.data)),jQuery.ajax(jQuery.extend({},this.getAjaxSettings(),i))},AeroGear.Pipeline.adapters.Rest.prototype.remove=function(e,t){var r,a,n,o,i,s=this,c=this.getRecordId(),u=this.getAjaxSettings(),p="";return"string"==typeof e||"number"==typeof e?r=e:e&&e[c]?r=e[c]:e&&!t&&(t=e),t=t||{},p=r?"/"+r:"",a=u.url+p,n=function(){t.success&&t.success.apply(this,arguments)},o=function(e){e=s.formatJSONError(e),t.error&&t.error.apply(this,arguments)},i={type:"DELETE",url:a,success:n,error:o,statusCode:t.statusCode,complete:t.complete,headers:t.headers,timeout:this.getTimeout()},jQuery.ajax(jQuery.extend({},u,i))},AeroGear.DataManager=function(e){return this instanceof AeroGear.DataManager?(AeroGear.Core.call(this),this.lib="DataManager",this.type=e?e.type||"Memory":"Memory",this.collectionName="stores",this.add(e),t):new AeroGear.DataManager(e)},AeroGear.DataManager.prototype=AeroGear.Core,AeroGear.DataManager.constructor=AeroGear.DataManager,AeroGear.DataManager.adapters={},AeroGear.DataManager.STATUS_NEW=1,AeroGear.DataManager.STATUS_MODIFIED=2,AeroGear.DataManager.STATUS_REMOVED=0,AeroGear.DataManager.adapters.Memory=function(e,t){if(!(this instanceof AeroGear.DataManager.adapters.Memory))return new AeroGear.DataManager.adapters.Memory(e,t);t=t||{};var r=t.recordId?t.recordId:"id",a=null;this.getRecordId=function(){return r},this.getData=function(){return a},this.setData=function(e){a=e},this.emptyData=function(){a=null},this.addDataRecord=function(e){a=a||[],a.push(e)},this.updateDataRecord=function(e,t){a[e]=t},this.removeDataRecord=function(e){a.splice(e,1)},this.traverseObjects=function(e,t,r){for(;"object"==typeof t&&r;)e=Object.keys(t)[0],t=t[e],r=r[e];return t===r?!0:!1}},AeroGear.DataManager.adapters.Memory.prototype.read=function(e){var t={};return t[this.getRecordId()]=e,e?this.filter(t):this.getData()},AeroGear.DataManager.adapters.Memory.prototype.save=function(e,t){var r=!1;if(e=AeroGear.isArray(e)?e:[e],t)this.setData(e);else if(this.getData())for(var a=0;e.length>a;a++){for(var n in this.getData())if(this.getData()[n][this.getRecordId()]===e[a][this.getRecordId()]){this.updateDataRecord(n,e[a]),r=!0;break}r||this.addDataRecord(e[a]),r=!1}else this.setData(e);return this.getData()},AeroGear.DataManager.adapters.Memory.prototype.remove=function(e){if(!e)return this.emptyData(),this.getData();e=AeroGear.isArray(e)?e:[e];for(var t,r,a,n=0;e.length>n;n++){if("string"==typeof e[n]||"number"==typeof e[n])t=e[n];else{if(!e)continue;t=e[n][this.getRecordId()]}r=this.getData(!0);for(a in r)r[a][this.getRecordId()]===t&&this.removeDataRecord(a)}return this.getData()},AeroGear.DataManager.adapters.Memory.prototype.filter=function(e,t){var r,a,n,o,i,s=this;return r=e?this.getData().filter(function(r){var c,u,p=t?!1:!0,h=Object.keys(e);for(a=0;h.length>a;a++){if(e[h[a]].data)for(c=e[h[a]],u=c.matchAny?!1:!0,n=0;c.data.length>n;n++)if(AeroGear.isArray(r[h[a]]))if(r[h[a]].length){if(0===jQuery(r[h]).not(c.data).length&&0===jQuery(c.data).not(r[h]).length){u=!0;break}for(o=0;r[h[a]].length>o;o++){if(c.matchAny&&c.data[n]===r[h[a]][o]){if(u=!0,t)break;for(i=0;r[h[a]].length>i;i++)if(!t&&c.data[n]!==r[h[a]][i]){u=!1;break}}if(!c.matchAny&&c.data[n]!==r[h[a]][o]){u=!1;break}}}else u=!1;else if("object"==typeof c.data[n]){if(c.matchAny&&s.traverseObjects(h[a],c.data[n],r[h[a]])){u=!0;break}if(!c.matchAny&&!s.traverseObjects(h[a],c.data[n],r[h[a]])){u=!1;break}}else{if(c.matchAny&&c.data[n]===r[h[a]]){u=!0;break}if(!c.matchAny&&c.data[n]!==r[h[a]]){u=!1;break}}else if(AeroGear.isArray(r[h[a]]))if(u=t?!1:!0,r[h[a]].length)for(n=0;r[h[a]].length>n;n++){if(t&&e[h[a]]===r[h[a]][n]){u=!0;break}if(!t&&e[h[a]]!==r[h[a]][n]){u=!1;break}}else u=!1;else u="object"==typeof e[h[a]]?s.traverseObjects(h[a],e[h[a]],r[h[a]]):e[h[a]]===r[h[a]]?!0:!1;if(t&&u){p=!0;break}if(!t&&!u){p=!1;break}}return p}):this.getData()||[]},AeroGear.DataManager.adapters.SessionLocal=function(t,r){if(!(this instanceof AeroGear.DataManager.adapters.SessionLocal))return new AeroGear.DataManager.adapters.SessionLocal(t,r);AeroGear.DataManager.adapters.Memory.apply(this,arguments);var a=r.storageType||"sessionStorage",n=t,o=document.location.pathname.replace(/[\/\.]/g,"-"),i=n+o,s=e[a].getItem(i),c=s?JSON.parse(s):null;c&&AeroGear.DataManager.adapters.Memory.prototype.save.call(this,c,!0),this.getStoreType=function(){return a},this.getStoreKey=function(){return i}},AeroGear.DataManager.adapters.SessionLocal.prototype=Object.create(new AeroGear.DataManager.adapters.Memory,{save:{value:function(t,r){var a=r&&r.reset?r.reset:!1,n=e[this.getStoreType()].getItem(this.getStoreKey()),o=AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[arguments[0],a]);try{e[this.getStoreType()].setItem(this.getStoreKey(),JSON.stringify(o)),r&&r.storageSuccess&&r.storageSuccess(o)}catch(i){if(n=n?JSON.parse(n):[],o=AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[n,!0]),!r||!r.storageError)throw i;r.storageError(i,t)}return o},enumerable:!0,configurable:!0,writable:!0},remove:{value:function(){var t=AeroGear.DataManager.adapters.Memory.prototype.remove.apply(this,arguments);return e[this.getStoreType()].setItem(this.getStoreKey(),JSON.stringify(t)),t},enumerable:!0,configurable:!0,writable:!0}}),AeroGear.Auth=function(e){return this instanceof AeroGear.Auth?(AeroGear.Core.call(this),this.lib="Auth",this.type=e?e.type||"Rest":"Rest",this.collectionName="modules",this.add(e),t):new AeroGear.Auth(e)},AeroGear.Auth.prototype=AeroGear.Core,AeroGear.Auth.constructor=AeroGear.Auth,AeroGear.Auth.adapters={},AeroGear.Auth.adapters.Rest=function(e,t){if(!(this instanceof AeroGear.Auth.adapters.Rest))return new AeroGear.Auth.adapters.Rest(e,t);t=t||{};var r=t.endpoints||{},a=e,n=t.baseURL||"";this.getSettings=function(){return t},this.getEndpoints=function(){return r},this.getName=function(){return a},this.getBaseURL=function(){return n},this.processOptions=function(e){var t={};return e.contentType&&(t.contentType=e.contentType),e.dataType&&(t.dataType=e.dataType),t.url=e.baseURL?e.baseURL:n,t}},AeroGear.Auth.adapters.Rest.prototype.enroll=function(e,t){t=t||{};var r=(this.getName(),this.getEndpoints()),a=function(){t.success&&t.success.apply(this,arguments)},n=function(e,r,a){var n;try{e.responseJSON=JSON.parse(e.responseText),n=[e,r,a]}catch(o){n=arguments}t.error&&t.error.apply(this,n)},o=jQuery.extend({},this.processOptions(t),{complete:t.complete,success:a,error:n,data:e});return o.url+=r.enroll?r.enroll:"auth/enroll","application/json"===o.contentType&&o.data&&"string"!=typeof o.data&&(o.data=JSON.stringify(o.data)),jQuery.ajax(jQuery.extend({},this.getSettings(),{type:"POST"},o))},AeroGear.Auth.adapters.Rest.prototype.login=function(e,t){t=t||{};var r=(this.getName(),this.getEndpoints()),a=function(){t.success&&t.success.apply(this,arguments)},n=function(e,r,a){var n;try{e.responseJSON=JSON.parse(e.responseText),n=[e,r,a]}catch(o){n=arguments}t.error&&t.error.apply(this,n)},o=jQuery.extend({},this.processOptions(t),{complete:t.complete,success:a,error:n,data:e});return o.url+=r.login?r.login:"auth/login","application/json"===o.contentType&&o.data&&"string"!=typeof o.data&&(o.data=JSON.stringify(o.data)),jQuery.ajax(jQuery.extend({},this.getSettings(),{type:"POST"},o))},AeroGear.Auth.adapters.Rest.prototype.logout=function(e){e=e||{};var t=(this.getName(),this.getEndpoints()),r=function(){e.success&&e.success.apply(this,arguments)},a=function(t,r,a){var n;try{t.responseJSON=JSON.parse(t.responseText),n=[t,r,a]}catch(o){n=arguments}e.error&&e.error.apply(this,n)},n=jQuery.extend({},this.processOptions(e),{complete:e.complete,success:r,error:a});return n.url+=t.logout?t.logout:"auth/logout",jQuery.ajax(jQuery.extend({},this.getSettings(),{type:"POST"},n))},AeroGear.Notifier=function(e){return this instanceof AeroGear.Notifier?(AeroGear.Core.call(this),this.lib="Notifier",this.type=e?e.type||"vertx":"vertx",this.collectionName="clients",this.add(e),t):new AeroGear.Notifier(e)},AeroGear.Notifier.prototype=AeroGear.Core,AeroGear.Notifier.constructor=AeroGear.Notifier,AeroGear.Notifier.adapters={},AeroGear.Notifier.CONNECTING=0,AeroGear.Notifier.CONNECTED=1,AeroGear.Notifier.DISCONNECTING=2,AeroGear.Notifier.DISCONNECTED=3,AeroGear.Notifier.adapters.vertx=function(e,t){if(!(this instanceof AeroGear.Notifier.adapters.vertx))return new AeroGear.Notifier.adapters.vertx(e,t);t=t||{};var r=t.channels||[],a=!!t.autoConnect||r.length,n=t.connectURL||"",o=AeroGear.Notifier.CONNECTING,i=null;this.getConnectURL=function(){return n},this.setConnectURL=function(e){n=e},this.getChannels=function(){return r},this.addChannel=function(e){r.push(e)},this.getChannelIndex=function(e){for(var t=0;r.length>t;t++)if(r[t].address===e)return t;return-1},this.removeChannel=function(e){var t=this.getChannelIndex(e.address);t>=0&&r.splice(t,1)},this.getState=function(){return o},this.setState=function(e){o=e},this.getBus=function(){return i},this.setBus=function(e){i=e},(a||r.length)&&this.connect({url:n,onConnect:t.onConnect,onDisconnect:t.onDisconnect,onConnectError:t.onConnectError})},AeroGear.Notifier.adapters.vertx.prototype.connect=function(e){e=e||{};var t=this,r=new vertx.EventBus(e.url||this.getConnectURL());r.onopen=function(){var r=t.getChannels().slice(0);t.setState(AeroGear.Notifier.CONNECTED),t.subscribe(r,!0),e.onConnect&&e.onConnect.apply(this,arguments)},r.onclose=function(){t.getState()===AeroGear.Notifier.DISCONNECTING?(t.setState(AeroGear.Notifier.DISCONNECTED),e.onDisconnect&&e.onDisconnect.apply(this,arguments)):e.onConnectError&&e.onConnectError.apply(this,arguments)},this.setBus(r)},AeroGear.Notifier.adapters.vertx.prototype.disconnect=function(){var e=this.getBus();this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),e.close())},AeroGear.Notifier.adapters.vertx.prototype.subscribe=function(e,t){var r=this.getBus();t&&this.unsubscribe(this.getChannels()),e=AeroGear.isArray(e)?e:[e];for(var a=0;e.length>a;a++)this.addChannel(e[a]),r.registerHandler(e[a].address,e[a].callback)},AeroGear.Notifier.adapters.vertx.prototype.unsubscribe=function(e){var t=this.getBus();e=AeroGear.isArray(e)?e:[e];for(var r=0;e.length>r;r++)this.removeChannel(e[r]),t.unregisterHandler(e[r].address,e[r].callback)},AeroGear.Notifier.adapters.vertx.prototype.send=function(e,t){var r=this.getBus();t=t||"",r.send(e,t)},AeroGear.Notifier.adapters.stompws=function(e,t){if(!(this instanceof AeroGear.Notifier.adapters.stompws))return new AeroGear.Notifier.adapters.stompws(e,t);t=t||{};var r=t.channels||[],a=!!t.autoConnect||r.length,n=t.connectURL||"",o=AeroGear.Notifier.CONNECTING,i=null;this.getConnectURL=function(){return n},this.setConnectURL=function(e){n=e},this.getChannels=function(){return r},this.addChannel=function(e){r.push(e)},this.getChannelIndex=function(e){for(var t=0;r.length>t;t++)if(r[t].address===e)return t;return-1},this.removeChannel=function(e){var t=this.getChannelIndex(e.address);t>=0&&r.splice(t,1)},this.getState=function(){return o},this.setState=function(e){o=e},this.getClient=function(){return i},this.setClient=function(e){i=e},!a&&!r.length||t.login||t.password||this.connect({url:n,onConnect:t.onConnect,onConnectError:t.onConnectError})},AeroGear.Notifier.adapters.stompws.prototype.connect=function(e){e=e||{};var t=this,r=new Stomp.client(e.url||this.getConnectURL(),e.protocol||"v11.stomp"),a=function(){var r=t.getChannels().slice(0);t.setState(AeroGear.Notifier.CONNECTED),t.subscribe(r,!0),e.onConnect&&e.onConnect.apply(this,arguments)},n=function(){t.setState(AeroGear.Notifier.DISCONNECTED),e.onConnectError&&e.onConnectError.apply(this,arguments)};r.connect(e.login,e.password,a,n,e.host),this.setClient(r)},AeroGear.Notifier.adapters.stompws.prototype.disconnect=function(e){var t=this,r=this.getClient(),a=function(){t.getState()===AeroGear.Notifier.DISCONNECTING&&(t.setState(AeroGear.Notifier.DISCONNECTED),e&&e.apply(this,arguments))};this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),r.disconnect(a))},AeroGear.Notifier.adapters.stompws.prototype.subscribe=function(e,t){var r=this.getClient();t&&this.unsubscribe(this.getChannels()),e=AeroGear.isArray(e)?e:[e];for(var a=0;e.length>a;a++)e[a].id=r.subscribe(e[a].address,e[a].callback),this.addChannel(e[a])},AeroGear.Notifier.adapters.stompws.prototype.unsubscribe=function(e){var t=this.getClient();e=AeroGear.isArray(e)?e:[e];for(var r=0;e.length>r;r++)t.unsubscribe(e[r].id),this.removeChannel(e[r])},AeroGear.Notifier.adapters.stompws.prototype.send=function(e,t){var r={},a=this.getClient();t=t||"",t.headers&&(r=t.headers,t=t.body),a.send(e,r,t)}})(this);
//@ sourceMappingURL=aerogear.js.map